"use strict";(self.webpackChunkmomento_docs=self.webpackChunkmomento_docs||[]).push([[9217],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>h});var o=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,s=function(e,t){if(null==e)return{};var n,o,s={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=o.createContext({}),p=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=p(e.components);return o.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),m=p(n),h=s,d=m["".concat(c,".").concat(h)]||m[h]||u[h]||r;return n?o.createElement(d,a(a({ref:t},l),{},{components:n})):o.createElement(d,a({ref:t},l))}));function h(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,a=new Array(r);a[0]=m;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:s,a[1]=i;for(var p=2;p<r;p++)a[p]=n[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9351:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>i,toc:()=>p});var o=n(7462),s=(n(7294),n(3905));const r={sidebar_position:20,title:"Best practices for async processing with Momento Topics",sidebar_label:"Running background tasks",description:"Learn best practices around using Momento Topics and webhooks to process data asynchronously in your event-driven architectures.",keywords:["topics","webhooks","eda","momento","event-driven architecture","Step Functions"]},a="Use Momento Topics to process data asynchronously",i={unversionedId:"topics/patterns/running-background-tasks",id:"topics/patterns/running-background-tasks",title:"Best practices for async processing with Momento Topics",description:"Learn best practices around using Momento Topics and webhooks to process data asynchronously in your event-driven architectures.",source:"@site/docs/topics/patterns/running-background-tasks.md",sourceDirName:"topics/patterns",slug:"/topics/patterns/running-background-tasks",permalink:"/topics/patterns/running-background-tasks",draft:!1,editUrl:"https://github.com/momentohq/public-dev-docs/tree/main/docs/topics/patterns/running-background-tasks.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{sidebar_position:20,title:"Best practices for async processing with Momento Topics",sidebar_label:"Running background tasks",description:"Learn best practices around using Momento Topics and webhooks to process data asynchronously in your event-driven architectures.",keywords:["topics","webhooks","eda","momento","event-driven architecture","Step Functions"]},sidebar:"topicsSidebar",previous:{title:"Instant messaging",permalink:"/topics/patterns/instant-messaging"},next:{title:"Identifying unique resources",permalink:"/topics/patterns/token_id_webhook"}},c={},p=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Getting Started",id:"getting-started",level:2}],l={toc:p};function u(e){let{components:t,...r}=e;return(0,s.kt)("wrapper",(0,o.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"use-momento-topics-to-process-data-asynchronously"},"Use Momento Topics to process data asynchronously"),(0,s.kt)("p",null,"With ",(0,s.kt)("a",{parentName:"p",href:"../"},"Momento Topics"),", you can subscribe to messages on a topic, as well as publish messages to a different topic. ",(0,s.kt)("a",{parentName:"p",href:"../webhooks/overview"},"Webhooks")," allow you to connect these topics to stateless consumers, which can then process these events asynchronously. Whether this is aggregating events by ",(0,s.kt)("inlineCode",{parentName:"p"},"topic_id"),", saving each event to a database, or using the payload to trigger a Step function workflow, webhooks give you the flexibility to process these events how you want to."),(0,s.kt)("p",null,"The key to asynchronously processing these events is to use ",(0,s.kt)("em",{parentName:"p"},"multiple")," topics. An inbound topic, which the webhook listens to, and a single, or multiple, outbound topics which publish the processed data."),(0,s.kt)("p",null,(0,s.kt)("img",{alt:"Architecture",src:n(1029).Z,width:"1260",height:"640"})),(0,s.kt)("p",null,"In this diagram, ",(0,s.kt)("inlineCode",{parentName:"p"},"Topic 1")," is the ",(0,s.kt)("inlineCode",{parentName:"p"},"inbound")," topic, and ",(0,s.kt)("inlineCode",{parentName:"p"},"Topic 2")," is the ",(0,s.kt)("inlineCode",{parentName:"p"},"outbound")," topic."),(0,s.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"A public-facing endpoint to receive webhook events. This endpoint must accept POST requests and be able to receive inbound calls from Momento. More detail about the structure of this event is ",(0,s.kt)("a",{parentName:"li",href:"../webhooks/overview#example-event"},"described here"),".")),(0,s.kt)("h2",{id:"getting-started"},"Getting Started"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("a",{parentName:"li",href:"https://console.gomomento.com/caches/create"},"Create a cache in the Momento console")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("a",{parentName:"li",href:"/topics/webhooks/creating-a-webhook"},"Create a webhook")," for the cache. Assign the webhook destination to the public facing endpoint."),(0,s.kt)("li",{parentName:"ol"},"Add code to the webhook to process the incoming messages. For example, if your webhook is implemented as an AWS Lambda function behind an API Gateway, then here is some very simple code that processes the incoming message, converts it to upper case, and then publishes it to the outbound topic:")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},'import {\n    APIGatewayProxyEvent,\n    APIGatewayProxyResult\n} from "aws-lambda/trigger/api-gateway-proxy";\n\nimport {TopicClient, CredentialProvider} from \'@gomomento/sdk\';\n\n\ninterface MomentoWebhookEvent {\n    cache: string;\n    topic: string;\n    event_timestamp: number;\n    publish_timestamp: number;\n    topic_sequence_number: number;\n    token_id: string;\n    text: string;\n}\n\nconst momento = new TopicClient({\n    credentialProvider: CredentialProvider.fromString(\'<the api key>\'),\n})\n\nexport const lambdaHandler = async (\n    event: APIGatewayProxyEvent\n): Promise<APIGatewayProxyResult> => {\n    const webhookEvent: WebhookEvent = JSON.parse(event.body);\n    // simply take the current message, uppercase it, and publish to a new topic\n    await momento.publish(webhookEvent.cache, "topic 2", webhookEvent.text.toUpperCase());\n    return {\n        statusCode: 200,\n        body: JSON.stringify({status : "success"})\n    }\n}\n')),(0,s.kt)("ol",{start:4},(0,s.kt)("li",{parentName:"ol"},"On the client side, add a subscriber to this new ",(0,s.kt)("inlineCode",{parentName:"li"},"topic 2"))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"const result = await topicClient.subscribe(cacheName, 'topic 2', {\n    onError: () => {\n        console.error('Received an error from the topic');\n        return;\n    },\n    onItem: (item: TopicItem) => {\n        console.log(`Received uppercase text on topic 'topic-b': ${item.value().toString()}`);\n        return;\n    },\n});\n")),(0,s.kt)("ol",{start:5},(0,s.kt)("li",{parentName:"ol"},"Begin publishing messages to the topic that the webhook is listening to. You can use the ",(0,s.kt)("a",{parentName:"li",href:"/topics/develop/api-reference"},"Momento SDK")," to publish to the topic.")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-typescript"},"import {TopicPublish} from '@gomomento/sdk';\nconst publishResponse = await topicClient.publish(cacheName, 'topic 1', 'a value');\nif (publishResponse instanceof TopicPublish.Success) {\n    console.log('Value published successfully!');\n} else {\n    console.log(`Error publishing value: ${publishResponse.toString()}`);\n}\n")),(0,s.kt)("ol",{start:6},(0,s.kt)("li",{parentName:"ol"},"The subscriber to ",(0,s.kt)("inlineCode",{parentName:"li"},"topic 2")," should now be receiving the uppercase messages, and logging the messages to the console!")),(0,s.kt)("p",null,"And that is it! This is an extremely basic example of string conversion, but this pattern holds true for more advanced asynchronous processing, such as saving state to a db or publishing messages to a queue. This topics pattern allows for clients to be completely agnostic of the downstream consumer, if the load for the application outgrows an environment such as API Gateway + Lambda function, you can easily replace it with containers or EC2 instances. For a more complete example of using webhooks for event processing, checkout our EventBridge ",(0,s.kt)("a",{parentName:"p",href:"/topics/integrations/lambda-handler"},"example"),", and our ",(0,s.kt)("a",{parentName:"p",href:"https://www.gomomento.com/blog/how-to-use-webhooks-and-momento-topics-to-build-a-multi-language-chat-app"},"blog post")," about using this pattern to create a multi-language chat application."))}u.isMDXComponent=!0},1029:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/asynchronous-processing-903673eec41b392af260e4aec0d8e2e2.png"}}]);