"use strict";(self.webpackChunkmomento_docs=self.webpackChunkmomento_docs||[]).push([[536],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>g});var o=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=o.createContext({}),u=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=u(e.components);return o.createElement(c.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,c=e.parentName,l=a(e,["components","mdxType","originalType","parentName"]),p=u(n),d=i,g=p["".concat(c,".").concat(d)]||p[d]||h[d]||r;return n?o.createElement(g,s(s({ref:t},l),{},{components:n})):o.createElement(g,s({ref:t},l))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,s=new Array(r);s[0]=d;var a={};for(var c in t)hasOwnProperty.call(t,c)&&(a[c]=t[c]);a.originalType=e,a[p]="string"==typeof e?e:i,s[1]=a;for(var u=2;u<r;u++)s[u]=n[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3976:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>u});var o=n(7462),i=(n(7294),n(3905));const r={sidebar_position:2,sidebar_label:"Security",title:"Webhook Security",description:"Learn how to secure your endpoint accepting webhook requests with request signatures and verification.",pagination_next:null,hide_title:!0,keywords:["momento","webhooks","security","eda","event-driven architectures","serverless"]},s="Secure your webhook endpoints",a={unversionedId:"topics/webhooks/security",id:"topics/webhooks/security",title:"Webhook Security",description:"Learn how to secure your endpoint accepting webhook requests with request signatures and verification.",source:"@site/docs/topics/webhooks/security.md",sourceDirName:"topics/webhooks",slug:"/topics/webhooks/security",permalink:"/topics/webhooks/security",draft:!1,editUrl:"https://github.com/momentohq/public-dev-docs/tree/main/docs/topics/webhooks/security.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Security",title:"Webhook Security",description:"Learn how to secure your endpoint accepting webhook requests with request signatures and verification.",pagination_next:null,hide_title:!0,keywords:["momento","webhooks","security","eda","event-driven architectures","serverless"]},sidebar:"topicsSidebar",previous:{title:"Getting Started",permalink:"/topics/webhooks/creating-a-webhook"}},c={},u=[{value:"Request signing",id:"request-signing",level:2},{value:"Verifying signatures with the Momento SDK",id:"verifying-signatures-with-the-momento-sdk",level:3},{value:"Verifying signatures manually",id:"verifying-signatures-manually",level:3},{value:"User Agent",id:"user-agent",level:2},{value:"Running test scenarios",id:"running-test-scenarios",level:3},{value:"Signing secret",id:"signing-secret",level:2},{value:"Obtaining your signing secret programmatically",id:"obtaining-your-signing-secret-programmatically",level:3},{value:"Obtaining your signing secret via the Momento console",id:"obtaining-your-signing-secret-via-the-momento-console",level:3},{value:"Considerations",id:"considerations",level:2},{value:"Replay attacking",id:"replay-attacking",level:3},{value:"Regularly rotate secrets",id:"regularly-rotate-secrets",level:3}],l={toc:u},p="wrapper";function h(e){let{components:t,...r}=e;return(0,i.kt)(p,(0,o.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"secure-your-webhook-endpoints"},"Secure your webhook endpoints"),(0,i.kt)("p",null,"After you successfully connect a webhook to Momento, it is recommended to validate incoming requests to guarantee the authenticity. Since your endpoint is publicly accessible, guaranteeing the sender is critical in protecting against bad actors. Authenticity and integrity of the requests can be validated in a couple of ways."),(0,i.kt)("h2",{id:"request-signing"},"Request signing"),(0,i.kt)("p",null,"Request signing is a security measure used in software systems to verify the authenticity and integrity of a message. Prior to publishing, Momento signs webhook events with a signature contained in the request's ",(0,i.kt)("inlineCode",{parentName:"p"},"momento-signature")," header. This signature uses your webhook's ",(0,i.kt)("a",{parentName:"p",href:"#signing-secret"},"signing secret")," and event request body to confirm authenticity. This allows you to verify the event originated from Momento, not from a 3rd party or malicious actor."),(0,i.kt)("h3",{id:"verifying-signatures-with-the-momento-sdk"},"Verifying signatures with the Momento SDK"),(0,i.kt)("p",null,"The Momento ",(0,i.kt)("a",{parentName:"p",href:"/sdks/nodejs"},"Node.js SDK")," includes native support for verifying signatures. This is the recommended approach to verify signatures. To verify, provide the raw request body, the signature, and your signing secret."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"import express from 'express';\nimport { WebhookUtils } from '@gomomento/sdk';\nconst app = express();\n\napp.post('/', (req, res) => {\n    const response = WebhookUtils.validateWebhookRequest({\n        body: req.rawBody,\n        signature: req.headers['momento-signature'],\n        signingSecret: process.env.SIGNING_SECRET\n    });\n\n    if (response === WebhookUtils.RequestValidation.VALID) {\n        // Request is valid. Continue processing.\n    } else {\n        res.status(403).send('Signature invalid');\n    }\n});\n")),(0,i.kt)("h3",{id:"verifying-signatures-manually"},"Verifying signatures manually"),(0,i.kt)("p",null,"For other languages, or if you prefer to verify the signature yourself, you can use an ",(0,i.kt)("em",{parentName:"p"},"HMAC SHA3-256")," with your signing secret to validate the incoming request."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"import * as crypto from 'crypto';\n\nconst didRequestComeFromMomento = (req, secret) => {\n    const hash = crypto.createHmac(\"SHA3-256\", secret);\n    const hashed = hash.update(req.rawBody).digest('hex');\n    return hashed === req.headers['momento-signature'];\n};\n")),(0,i.kt)("h2",{id:"user-agent"},"User Agent"),(0,i.kt)("p",null,"In addition to the digital signature, all webhook events also receive a ",(0,i.kt)("inlineCode",{parentName:"p"},"User-Agent")," header. This can be used to in conjunction with the signature to guarantee authenticity or used to divert the workflow for testing scenarios. This header is a static value that only changes on major version releases:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Momento/1.0 (Webhooks; +https://docs.momentohq.com/topics/webhooks)")),(0,i.kt)("p",null,"The value is composed of the following pieces:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Momento")," - Indicates the origin is from Momento"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"1.0")," - Major version number of the service"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Webhooks")," - States the specific origin from the request"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"+",(0,i.kt)("a",{parentName:"strong",href:"https://docs.momentohq.com/topics/webhooks"},"https://docs.momentohq.com/topics/webhooks"))," - Additional information about the webhook service can be found here")),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Do not exlusively use this value to validate incoming requests. This header is easily spoofed and is not intended to verify authenticity on its own.")),(0,i.kt)("h3",{id:"running-test-scenarios"},"Running test scenarios"),(0,i.kt)("p",null,"Before bringing your app to production, you might want to test your webhook is in working order and you can verify requests without executing your production code. This is where the ",(0,i.kt)("inlineCode",{parentName:"p"},"User-Agent")," header can be used to divert execution of your code. By creating a request, signing it yourself using the ",(0,i.kt)("a",{parentName:"p",href:"#verifying-signatures-manually"},"manual verification code"),", and publishing to your endpoint with a different ",(0,i.kt)("inlineCode",{parentName:"p"},"User-Agent")," header value, you can shortcut the execution after verifying the payload."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const MOMENTO_USER_AGENT = 'Momento/1.0 (Webhooks; +https://docs.momentohq.com/topics/webhooks)';\nconst TEST_USER_AGENT = 'Test Harness/PostmanRuntime';\n\napp.post('/', (req, res) => {\n    if(didRequestComeFromMomento(req, process.env.SIGNING_SECRET)){\n        if(req.headers['User-Agent'] === MOMENTO_USER_AGENT){\n            // Continue processing\n        } else if (req.headers['User-Agent'] === TEST_USER_AGENT) {\n            // This is a test request, return success\n            res.status(200).send('Skipping execution');\n        }\n    } else {\n        res.status(403).send('Signature invalid');\n    }\n});\n")),(0,i.kt)("h2",{id:"signing-secret"},"Signing secret"),(0,i.kt)("p",null,"When you create a new webhook in Momento you will be provided a signing secret. This secret value is used to digitally sign event payloads from Momento, allowing you to verify authenticity of a request. You can obtain the secret in either programmatically or via the ",(0,i.kt)("a",{parentName:"p",href:"https://console.gomomento.com"},"Momento console"),"."),(0,i.kt)("h3",{id:"obtaining-your-signing-secret-programmatically"},"Obtaining your signing secret programmatically"),(0,i.kt)("p",null,"When you create a new webhook with the ",(0,i.kt)("a",{parentName:"p",href:"./../develop/api-reference/webhooks#put-webhook-api"},"putWebhook API"),", you will receive the signing secret as part of a successful response. If you lose the secret or forget to save it as part of the request, the ",(0,i.kt)("a",{parentName:"p",href:"./../develop/api-reference/webhooks#get-webhook-secret-api"},"getWebhookSecret API")," will return the current value."),(0,i.kt)("h3",{id:"obtaining-your-signing-secret-via-the-momento-console"},"Obtaining your signing secret via the Momento console"),(0,i.kt)("p",null,"If you prefer using the Momento console, you can always navigate to your webhook and click on the ",(0,i.kt)("em",{parentName:"p"},"copy")," button next on the secret string row."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Webhook detail page in the Momento Console",src:n(9506).Z,width:"795",height:"551"})),(0,i.kt)("p",null,"To navigate to the webhook detail page, click on the cache of your choice on the ",(0,i.kt)("a",{parentName:"p",href:"https://console.gomomento.com/caches"},"cache list page"),". Navigate to the ",(0,i.kt)("em",{parentName:"p"},"Webhooks")," menu option and click on the webhook you wish to view."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"When you first create a webhook you will be navigated to the webhook list page. To retrieve the signing secret, you must then click into the webhook and press the copy button.")),(0,i.kt)("h2",{id:"considerations"},"Considerations"),(0,i.kt)("p",null,"The verification information listed above is the minimum required to guarantee authenticity of an incoming request. However, further security best practices should also be considered when building your webhook."),(0,i.kt)("h3",{id:"replay-attacking"},"Replay attacking"),(0,i.kt)("p",null,"If a valid webhook event is intercepted by a malicious actor and your endpoint implements sender verification only, you are susceptible to a ",(0,i.kt)("em",{parentName:"p"},"replay attack"),". A replay attack occurs when a bad actor sends a valid request to your system repeatedly, forcing your system to process the same event multiple times. To prevent these attacks from harming your system, consider also validating the age of the event. Any event that comes in older than your allowed age threshold would be automatically discarded."),(0,i.kt)("p",null,"You can use the ",(0,i.kt)("a",{parentName:"p",href:"./overview#publish_timestamp"},"publish_timestamp")," property of the event to determine age. As best practice, consider rejecting events ",(0,i.kt)("em",{parentName:"p"},"older than 60 seconds"),"."),(0,i.kt)("h3",{id:"regularly-rotate-secrets"},"Regularly rotate secrets"),(0,i.kt)("p",null,"If your webhook signing secret is compromised, you cannot guarantee authenticity of a request. Consider rotating the secret periodically to ensure safety of your endpoints. You can rotate a secret using the ",(0,i.kt)("a",{parentName:"p",href:"./../develop/api-reference/webhooks#rotate-webhook-secret-api"},"rotateWebhookSecret API"),"."))}h.isMDXComponent=!0},9506:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/webhook-secret-string-ca389eaa23753d7e13c860f6fc87dbbc.png"}}]);