<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Write-aside caching with Momento Serverless Cache | Momento Serverless Cache</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Write-aside caching with Momento Serverless Cache | Momento Serverless Cache"><meta data-rh="true" name="description" content="In the previous step, we added our initial caching implementation by adding read-aside caching to our application. As part of that, we learned about different caching strategies and the factors to consider in choosing a cache strategy."><meta data-rh="true" property="og:description" content="In the previous step, we added our initial caching implementation by adding read-aside caching to our application. As part of that, we learned about different caching strategies and the factors to consider in choosing a cache strategy."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/ja/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento" hreflang="x-default"><!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-THBDHDQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><link rel="stylesheet" href="/assets/css/styles.0a21e8d5.css">
<link rel="preload" href="/assets/js/runtime~main.6ae856c2.js" as="script">
<link rel="preload" href="/assets/js/main.f9ba4b15.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.gomomento.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/momentohq/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/ja/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-title">Table of Contents</span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-overview"><a class="menu__link" href="/">Momento Serverless Cache</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/what-is-serverless-caching">Introduction</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-getting-started"><a class="menu__link" href="/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-item-api-reference"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Develop</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Adding a cache to a serverless application</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Introduction and setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/deploying-a-basic-serverless-application">Deploying a basic serverless application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/configuring-momento">Configuring Momento Serverless Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento">Read-aside caching with Momento Serverless Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento">Write-aside caching with Momento Serverless Cache</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item sidebar-item-data-types"><a class="menu__link" tabindex="0" href="/develop/datatypes">Data Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/develop/guides/caching-with-aws-lambda">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/develop/api-reference">API reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/how-it-works">Learn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-limits"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/manage/pricing">Manage</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Develop</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Adding a cache to a serverless application</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Write-aside caching with Momento Serverless Cache</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Write-aside caching with Momento Serverless Cache</h1><p>In the previous step, we added our initial caching implementation by adding read-aside caching to our application. As part of that, we learned about different caching strategies and the factors to consider in choosing a cache strategy.</p><p>In this step, we&#x27;ll evolve our caching strategy a bit. We&#x27;ll add write-aside caching to our current read-aside implementation to ensure our cached data stays fresh. In doing so, we&#x27;ll discuss some practical and conceptual tips for ensuring data freshness in your cache.</p><p>If you want to skip the concepts and go directly to the code, navigate ahead to the <a href="#implementing-a-write-aside-caching-strategy">implementation section</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts-on-cache-freshness">Key concepts on cache freshness<a class="hash-link" href="#key-concepts-on-cache-freshness" title="Direct link to heading">​</a></h2><p>One of the most cited quotes in programming is &quot;There are only two hard things in computer science -- cache invalidation and naming things.&quot;</p><p>Naming things is outside of the scope of this tutorial (and seems to be truly unsolvable). However, the intricacies of cache invalidation are right on point and are worth discussing further.</p><p>What makes cache invalidation one of the hardest problems in computer science? There are two main factors at play here.</p><p>First, a cache is only a copy of some true data. The actual data is stored in some primary data store, likely one that has durability, transactionality, and other functionality that a cache doesn&#x27;t support. The cache is optimized for fast reads and removes unnecessary features in support of this goal.</p><p>The problem here is that you now have two sources of data -- the primary and the cached -- and something is responsible for keeping them in sync. This requires a deep understanding of your application requirements and a tight integration between your read and write paths to ensure a satisfactory outcome to your end users.</p><p>The second problem is in the tradeoff between cache availability and cache hit rate. Caches use memory to store data for quick retrieval, and RAM is more expensive than disk. Rather than store your entire data set in your cache, you want to only store data that is likely to be accessed again in the near future.</p><p>This tradeoff is even more important in the world of static, instance-based caches. You need to pre-provision your cache size ahead of time, and you&#x27;ll pay for that cache size being available regardless of whether you use it or not. Further, if your cache runs out of room, you&#x27;ll need to rely on an eviction mechanism to eject entries from your cache. If you&#x27;re not careful about cache management and eviction, this can make a problem go from bad to worse as you get a spike in evictions and increased load on your primary data sources.</p><p>With Momento, this problem is diminished. Momento is a dynamic cache that doesn&#x27;t require pre-provisioning a specific cache size. You only need to specify the TTL value for a particular cache entry, and Momento will ensure it is available until the expiry.</p><p>This greatly reduces the number of factors you need to consider in caching. You don&#x27;t need to monitor overall memory usage and balance an unused, over-provisioned cache during downtimes against your peak usage. Rather, you only need to balance your cache hit rate against your overall spend. This makes it much easier to tune your TTL in a way that makes sense to you and your users.</p><p>Now that we know about cache freshness and the difficulties of cache invalidation, let&#x27;s go ahead and update our application code to use a write-aside strategy as well.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-a-write-aside-caching-strategy">Implementing a write-aside caching strategy<a class="hash-link" href="#implementing-a-write-aside-caching-strategy" title="Direct link to heading">​</a></h2><p>Let&#x27;s go back and implement write-aside caching in our serverless application. To do this, we will proactively store an entry in our cache whenever we write the underlying data. This pattern will be in addition to our existing read-aside strategy, and we&#x27;ll update our read-aside implementation in light of these changes.</p><p>In implementing caching, it&#x27;s good to do an audit of all the different places your data can change to ensure you&#x27;re not caching stale data. This is particularly true when you have multiple places manipulating and displaying the same piece of data. You should also be careful when caching data that is out of your control, such as that which belongs to another service.</p><p>The caching requirements are pretty straightforward in our application. We are only caching data that belongs to our service. Additionally, there are only a few paths to update the data, and they all flow through the AccountService class that we created.</p><p>Let&#x27;s start by adding write-aside caching for our User object.</p><p>Open the <code>src/accounts/service.js</code> file and find the <code>createUser</code> method on your AccountService class definition. Update it so it looks as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async createUser({ username, firstName, lastName }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const user = new User({ username, firstName, lastName });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await this._dynamoDBClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .putItem({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TableName: TABLE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Item: user.toItem(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ConditionExpression: &quot;attribute_not_exists(PK)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await this._cacheClient.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      getUserCacheKey(user),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      JSON.stringify(user.toItem()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      1800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return user;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } catch (error) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (error.code === &quot;ConditionalCheckFailedException&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      throw new UserAlreadyExistsError(username);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw error;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the only change we&#x27;re making to our existing function is caching our User item after it was successfully stored in DynamoDB. Other than that, the code runs exactly as before.</p><p>There are two other notes we should discuss as we update our code.</p><p>First, notice that we&#x27;re using a <code>getUserCacheKey</code> function to generate the cache key when storing our User item. This is because we&#x27;re now using this cache key in two places -- once in the <code>createUser</code> method and once in the <code>getUser</code> method. We want to ensure these two methods are using the same value, so we&#x27;ll centralize that in a function that both methods can call.</p><p>Add the following <code>getUserCacheKey</code> function to the bottom of your <code>src/accounts/service.js</code> file so it can be used by both methods:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const getUserCacheKey = (user) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return `USER#${user.username}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The second thing to notice about our update is that we&#x27;re using a much longer TTL value when storing our User item. Rather than storing our item for 60 seconds, we&#x27;re storing it for 1800 seconds (30 minutes).</p><p>Because we are now using write-aside caching as well, we can be more aggressive in caching our data for longer periods of time. We don&#x27;t have to worry about our cached data becoming stale as we will update the cached item whenever it changes.</p><p>And because Momento is a dynamic, elastic cache that does not require pre-provisioning a set amount of memory, we don&#x27;t need to think about managing our cache size to prevent eviction by algorithm. The only thing we need to focus on is how long we should keep our data around. This makes it easier to balance fewer concerns -- our cache hit rate vs. our bill -- rather than a larger variety of considerations.</p><p>Let&#x27;s make corresponding changes to our getUser method above. Update the getUser method so it looks as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async getUser({ username }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const user = new User({ username });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let getResp = await this.cacheClient.get(CACHE_NAME, getUserCacheKey(user));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (getResp.status === CacheGetStatus.Hit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cacheContent = JSON.parse(getResp.text());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cacheContent ? itemToUser(cacheContent) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await this._dynamoDBClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getItem({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableName: TABLE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Key: user.keys(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  await this._cacheClient.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process.env.CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userCacheKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JSON.stringify(response.Item),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return response.Item ? itemToUser(response.Item) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The changes here are pretty minimal. First, we removed the template literal to generate the user cache key and instead used the <code>getUserCacheKey</code> function that is used by the <code>createUser</code> method. Then, we changed the TTL from 60 to 1800 when storing a User item in the cache.</p><p>Notice how well the combination of a write-aside and read-aside cache work together. By using a read-aside strategy, we can improve the latency of frequently accessed items. By adding a write-aside strategy, we can cache these items for longer without worrying about data consistency issues. And by using Momento for our implementation, we don&#x27;t need to worry about running out of room in our cache.</p><p>You can make similar changes to the other methods in the AccountService to implement write-aside caching. As noted above, having stale Membership data could be particularly disruptive to our application users. They might not be able to access something they should have access to or, even worse, might be allowed to access something they shouldn&#x27;t have access to. By adding write-aside caching, we can prevent these undesirable scenarios.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h2><p>That concludes this tutorial on adding a cache to your serverless application. You can remove your application by running the following command in your terminal:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">serverless remove</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this tutorial, we learned some practical steps for integrating Momento into your application as well as some conceptual material about caching strategies, the Lambda execution model, and implementation considerations.</p><p>If you are looking for practical tips on using Momento with AWS Lambda, be sure to look at our reference guide for <a href="/develop/guides/caching-with-aws-lambda">adding caching to AWS Lambda functions</a>.</p><p>If you want a broader overview of concepts discussed in this tutorial, check out our pages on <a href="/learn/how-it-works">Momento concepts</a> and <a href="/introduction/common-caching-strategies">caching strategies</a>.</p><p>If you&#x27;re looking to get started with Momento, check out our <a href="/getting-started">quickstart tutorial</a> to get your credentials and cache your first item in less than 5 minutes.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/momentohq/public-dev-docs/tree/main/docs/develop/tutorials/serverless-cache-walkthrough/5-write-aside-caching-with-momento.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Read-aside caching with Momento Serverless Cache</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-concepts-on-cache-freshness" class="table-of-contents__link toc-highlight">Key concepts on cache freshness</a></li><li><a href="#implementing-a-write-aside-caching-strategy" class="table-of-contents__link toc-highlight">Implementing a write-aside caching strategy</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Documentation Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/3HkAKjUZGq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div><div class="col footer__col"><div class="footer__title">Language</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.momentohq.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">English</a></li><li class="footer__item"><a href="https://docs.momentohq.com/ja/" target="_blank" rel="noopener noreferrer" class="footer__link-item">日本語</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 Momento, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.6ae856c2.js"></script>
<script src="/assets/js/main.f9ba4b15.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-THBDHDQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>