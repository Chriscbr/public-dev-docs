<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Read-aside caching with Momento Cache | Momento Cache</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Read-aside caching with Momento Cache | Momento Cache"><meta data-rh="true" name="description" content="In the previous step, we installed and configured Momento within our serverless application. As part of that, we learned some important details about the Lambda lifecycle that will help with performance, particularly when making external network calls from our application."><meta data-rh="true" property="og:description" content="In the previous step, we installed and configured Momento within our serverless application. As part of that, we learned some important details about the Lambda lifecycle that will help with performance, particularly when making external network calls from our application."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/ja/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento" hreflang="x-default"><!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-THBDHDQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><link rel="stylesheet" href="/assets/css/styles.3b3a5d29.css">
<link rel="preload" href="/assets/js/runtime~main.08b82a46.js" as="script">
<link rel="preload" href="/assets/js/main.b2e358c7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.gomomento.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/momentohq/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/ja/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-title">Table of Contents</span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-overview"><a class="menu__link" href="/">Momento Cache</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/momento-topics">Introduction</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-getting-started"><a class="menu__link" href="/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-item-api-reference"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Develop</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Adding a cache to a serverless application</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">Introduction and setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/deploying-a-basic-serverless-application">Deploying a basic serverless application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/configuring-momento">Configuring Momento Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento">Read-aside caching with Momento Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento">Write-aside caching with Momento Cache</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item sidebar-item-data-types"><a class="menu__link" tabindex="0" href="/develop/datatypes">Data Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/develop/guides/caching-with-aws-lambda">Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed sidebar-item-limits"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/develop/sdks-integrations/redis-client-compatibility">SDKS and Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/develop/api-reference">API reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/how-it-works">Learn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-limits"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/manage/pricing">Manage</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Develop</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Adding a cache to a serverless application</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Read-aside caching with Momento Cache</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Read-aside caching with Momento Cache</h1><p>In the previous step, we installed and configured Momento within our serverless application. As part of that, we learned some important details about the Lambda lifecycle that will help with performance, particularly when making external network calls from our application.</p><p>In this step, we&#x27;ll actually implement caching in our application. Before we do so, we will learn some key concepts about caching strategies. Then, we&#x27;ll implement a read-aside cache in our serverless application.</p><p>If you want to skip the concepts and go directly to the implementation, navigate ahead to the <a href="#implementing-a-read-aside-caching-strategy">implementation section</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts-on-caching-strategies">Key concepts on caching strategies<a href="#key-concepts-on-caching-strategies" class="hash-link" aria-label="Direct link to Key concepts on caching strategies" title="Direct link to Key concepts on caching strategies">​</a></h2><p>There are a number of different reasons for adding caching to your application, as well as a variety of caching strategies that you can use to accomplish your goals. In general, you have to make choices on three factors in choosing a caching strategy:</p><ul><li><p><strong>Where to cache:</strong> Is my cache local to my application process or does it require a network call to a remote instance?</p></li><li><p><strong>When to cache:</strong> Do I update my cache lazily, after a read from the primary data source, or do I update my cache optimistically, after performing a write operation?</p></li><li><p><strong>How to cache:</strong> Is my cache a generic store for any type of application data I choose, or is the cache specifically designed for integration with my underlying data source?</p></li></ul><p>Making the proper choice on each of these factors is important to implementing a caching strategy that works for your application. For more on each of these factors and various combinations, check out our <a href="/introduction/common-caching-strategies">guide to caching strategies</a>.</p><p>In this example, we will use a read-aside caching strategy (also called a &quot;lazy-loading&quot; strategy). In a read-aside caching strategy, you first try to read your cached entry from a remote cache whenever your object is requested. If the object does not exist in the cache, then you fallback to reading the object from the primary data source. After retrieving from the primary data source, you store the object in your cache before returning so it&#x27;s available the next time it is requested.</p><p>This is the most common caching strategy due to its simplicity and applicability to a wide range of applications. Let&#x27;s see how it breaks down on the three factors above.</p><p>First, it uses a <em>remote</em> caching strategy, as our application will reach out to Momento to check for cached values.</p><p>While a local, in-memory caching strategy is easier to implement, a remote cache is a common choice. A local cache strategy has a lower cache hit rate since the hit rate decreases as the number of instances running your application increase. Given what we know about the Lambda function runtime, where we could have a large number of function instances handling our requests, a remote cache is a better fit for our needs.</p><p>Second, it chooses to cache our data at read time.</p><p>We will insert items into the cache only after a previous attempt to read from the cache fails, necessitating a fallback to the primary data source. This is the simplest pattern to implement, but it can result in stale reads when the underlying data changes as well as a lower cache hit rate. We&#x27;ll talk more about this in the next step.</p><p>Finally, it uses a <em>cache-aside</em> mechanism rather than an <em>inline</em> approach.</p><p>We&#x27;ll use Momento Cache, a serverless key-value cache, to store any data we want, rather than an inline cache that has a tight integration with Amazon DynamoDB. DynamoDB does have Amazon DynamoDB Accelerator (DAX) as an inline cache for DynamoDB. However, it is not serverless, requires the use of a VPC and complicated network configuration that are not a good fit for a serverless application. The cache-aside strategy with Momento Cache is a better approach here.</p><p>Now that we know the three factors to consider in choosing our caching strategy and the reasons we chose a read-aside strategy, let&#x27;s get to work implementing this in our application.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-a-read-aside-caching-strategy">Implementing a read-aside caching strategy<a href="#implementing-a-read-aside-caching-strategy" class="hash-link" aria-label="Direct link to Implementing a read-aside caching strategy" title="Direct link to Implementing a read-aside caching strategy">​</a></h2><p>Head back to the code for your serverless application. To implement our read-aside cache strategy, we will update our code to use the cache whenever fetching individual records with our service.</p><p>Navigate back to the service code in <code>src/accounts/service.js</code>. Update the getUser method on our AccountService class to the following:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async getUser({ username }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const user = new User({ username });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const userCacheKey = `USER#${user.username}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let getResp = await this._cacheClient.get(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userCacheKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (getResp.status === CacheGetStatus.Hit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cacheContent = JSON.parse(getResp.text());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cacheContent ? itemToUser(cacheContent) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await this._dynamoDBClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getItem({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableName: TABLE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Key: user.keys(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  await this._cacheClient.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    userCacheKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JSON.stringify(response.Item || &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return response.Item ? itemToUser(response.Item) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are three changes to our code.</p><p>First, we&#x27;ve defined the string template for our User cache key, which is &quot;<em>USER#{user.username}&quot;.</em> Like most caches, Momento is a key-value store. We will retrieve specific cache entries by their key and thus we need a defined format for generating and retrieving that key. Because this function is the only place that we will use the key for a User entry, we can declare it inline.</p><p>Second, we add logic to attempt to retrieve the entry from our cache using the cache key. If the response indicates that there was a hit from the cache, we will retrieve the value and return it to the caller. If it was a cache miss, then we&#x27;ll continue on to read from the database.</p><p>Finally, we add code to store the User item in our cache after retrieving it from our DynamoDB table. This ensures that the User item will be around for the next request that needs to retrieve the User.</p><p>Note two things about storing the User item. First, a GetItem response from DynamoDB can be empty, indicating that the item does not exist in DynamoDB. However, we are storing the response in our cache either way. This will ensure our application will get caching benefits even for objects that are requested but don&#x27;t exist.</p><p>Second, we are setting a time-to-live (&quot;TTL&quot;) value of 60 seconds. This tells Momento how long to keep the cache entry in the cache before deleting it. Any request made within this period will benefit from the cached value, while expiration of the entry will require a slower request to the primary data source.</p><p>Choosing the proper TTL value depends on your application needs, including how frequently an object is retrieved following an initial request and whether the underlying data is likely to change. For more on this, check out the section on TTL values in our caching concepts documentation.</p><p>For now, we&#x27;re using a relatively short TTL of only 60 seconds. This is mostly because we&#x27;re caching only on the read side. Because this underlying data can change, we want to expire it quickly to prevent a confusing experience for our users. In the next step, we&#x27;ll see how to integrate caching on the write side to allow for a longer TTL.</p><p>Finally, we need to update some imports and global variables for our service module. Add the following code to the top of your src/accounts/service.js file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const { CacheGetStatus } = require(&quot;@gomomento/sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const TABLE_NAME = process.env.TABLE_NAME;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const CACHE_NAME = process.env.CACHE_NAME;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The import is used when checking the result of the cache retrieval request, and the CACHE_NAME variable is used for all caching operations.</p><p>Let&#x27;s implement similar logic for our Organization and Membership objects as well.</p><p>In the <code>src/accounts/service.js</code> file, update the <code>getOrganization</code> method to look as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async getOrganization({ organizationName }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const organization = new Organization({ organizationName });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const organizationCacheKey = `ORG#${organization.organizationName}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let getResp = await this._cacheClient.get(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organizationCacheKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (getResp.status === CacheGetStatus.Hit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cacheContent = JSON.parse(getResp.text());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cacheContent ? itemToOrganization(cacheContent) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await this._dynamoDBClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getItem({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableName: TABLE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Key: organization.keys(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  await this._cacheClient.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organizationCacheKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JSON.stringify(response.Item || &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return response.Item ? itemToOrganization(response.Item) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that it follows a similar pattern as the User caching implementation. We define the cache key pattern for the Organization item. Then we try to retrieve a cached Organization entry and return it if it exists. If not, we fetch it from DynamoDB, store it in our cache, and return it to the caller.</p><p>Finally, in the <code>src/accounts/service.js</code> file, update the <code>getMembership</code> method to look as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async getMembership({ organizationName, username }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const membership = new Membership({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organizationName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memberUsername: username,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const membershipCacheKey = `MEMBER#${membership.organizationName}#${membership.memberUsername}`;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let getResp = await this._cacheClient.get(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process.env.CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    membershipCacheKey</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (getResp.status === CacheGetStatus.Hit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const cacheContent = JSON.parse(getResp.text());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return cacheContent ? itemToMembership(cacheContent) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await this._dynamoDBClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getItem({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      TableName: TABLE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      Key: membership.keys(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  await this._cacheClient.set(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    process.env.CACHE_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    membershipCacheKey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    JSON.stringify(response.Item || &quot;&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return response.Item ? itemToMembership(response.Item) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that it follows a similar pattern as the User and Organization caching implementations.</p><p>Before we deploy, let&#x27;s make one final note. We&#x27;ve implemented very simple caching of individual objects in our application. Those will certainly help readers that use our REST endpoints to retrieve a User, Organization, or Membership by reducing latency for cached items.</p><p>However, the caching will help for other endpoints as well. Take a look at the createOrganization method for our AccountService:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async createOrganization({ organizationName, foundingUser }) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const user = await this.getUser({ username: foundingUser });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!user) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    throw new UserDoesNotExistError(foundingUser);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Before creating a new Organization, our code first checks to ensure the creating User exists. It is calling into the same getUser method that would be used by our endpoint to retrieve a User, so both methods are improved by our simple caching.</p><p>To see an even better example, look at the addUserToOrganization method:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async addUserToOrganization({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  organizationName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  memberUsername,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  role,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addingUser,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const [organization, newMemberUser, addingMembership] = await Promise.all([</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.getOrganization({ organizationName }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.getUser({ username: memberUsername }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.getMembership({ organizationName, username: addingUser }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At the beginning of this method, we have to make three other reads -- one for the Organization, one for the User being added to the Organization, and one for the Membership record of the user creating the new Membership. Because we&#x27;ve added caching to each of those methods, we should see lower latency on this endpoint.</p><p>This is what&#x27;s great about our simple caching. It&#x27;s pretty easy to reason about our cache setup as we&#x27;re only handling individual objects. However, it&#x27;s making almost all of our endpoints faster as many of them rely on these individual objects.</p><p>In this step, we implemented simple read-aside caching in our application. However, there&#x27;s still a big problem with our caching setup. Even though we&#x27;re only caching our objects for 60 seconds, there&#x27;s still a chance that the underlying data has changed in the interim. Further, our cache hit rate is likely low as the initial read is always retrieved from the primary datastore.</p><p>In the next step, we&#x27;ll look at cache invalidation and refreshing cached data on the write side.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/momentohq/public-dev-docs/tree/main/docs/develop/tutorials/serverless-cache-walkthrough/4-read-aside-caching-with-momento.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/develop/tutorials/serverless-cache-walkthrough/configuring-momento"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuring Momento Cache</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Write-aside caching with Momento Cache</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-concepts-on-caching-strategies" class="table-of-contents__link toc-highlight">Key concepts on caching strategies</a></li><li><a href="#implementing-a-read-aside-caching-strategy" class="table-of-contents__link toc-highlight">Implementing a read-aside caching strategy</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Documentation Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/3HkAKjUZGq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div><div class="col footer__col"><div class="footer__title">Language</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.momentohq.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">English</a></li><li class="footer__item"><a href="https://docs.momentohq.com/ja/" target="_blank" rel="noopener noreferrer" class="footer__link-item">日本語</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2023 Momento, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.08b82a46.js"></script>
<script src="/assets/js/main.b2e358c7.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-THBDHDQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>