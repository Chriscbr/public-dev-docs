<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-serverless-cache-walkthrough/configuring-momento">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Momento Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Momento Docs Atom Feed"><title data-rh="true">Configuring Momento in Serverless | Momento Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://momentohq.github.io/docs/serverless-cache-walkthrough/configuring-momento"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Configuring Momento in Serverless | Momento Docs"><meta data-rh="true" name="description" content="In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application."><meta data-rh="true" property="og:description" content="In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://momentohq.github.io/docs/serverless-cache-walkthrough/configuring-momento"><link data-rh="true" rel="alternate" href="https://momentohq.github.io/docs/serverless-cache-walkthrough/configuring-momento" hreflang="en"><link data-rh="true" rel="alternate" href="https://momentohq.github.io/docs/serverless-cache-walkthrough/configuring-momento" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3037503f.css">
<link rel="preload" href="/assets/js/runtime~main.ee4614db.js" as="script">
<link rel="preload" href="/assets/js/main.26e96dc6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/momentohq/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Momento</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/how-it-works">How it works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How it works&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/caching-concepts">Caching Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Caching Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/API-reference">API Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/guides">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/serverless-cache-walkthrough">Walkthrough - Adding a cache to a serverless application</a><button aria-label="Toggle the collapsible sidebar category &#x27;Walkthrough - Adding a cache to a serverless application&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/serverless-cache-walkthrough/adding-a-cache-to-serverless">Introduction and setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/serverless-cache-walkthrough/deploying-a-basic-serverless-application">Deploying a basic serverless application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/serverless-cache-walkthrough/configuring-momento">Configuring Momento in Serverless</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/serverless-cache-walkthrough/read-aside-caching-with-momento">Read-aside caching with Momento</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/serverless-cache-walkthrough/write-aside-caching-with-momento">Write-aside caching with Momento</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/serverless-cache-walkthrough"><span itemprop="name">Walkthrough - Adding a cache to a serverless application</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configuring Momento in Serverless</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configuring Momento in Serverless</h1><p>In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application.</p><p>In the next few steps, we&#x27;re going to add caching to our serverless application using Momento. The account management service will be heavily relied upon by other services, so we want to make sure it is fast and reliable. Using a cache will reduce latency and the load on our primary database.</p><p>In this step, we will sign up for the Momento service and configure it for usage in our serverless application. As we do so, we will learn more key concepts about using Lambda correctly, including some subtle details about the runtime model that make a big difference in performance. For this step, we&#x27;ll be using the <code>step-2</code> branch in the tutorial repository (TODO LINK).</p><p>If you want to skip the concepts and go directly to the implementation, navigate ahead to the section on <a href="#installing-and-configuring-momento-in-your-serverless-application">installing and configuring Momento in your serverless application</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="key-concepts-about-the-lambda-runtime-model">Key concepts about the Lambda runtime model<a class="hash-link" href="#key-concepts-about-the-lambda-runtime-model" title="Direct link to heading">​</a></h2><p>Before we get to the implementation, we&#x27;re going to examine two concepts that will help us understand how we&#x27;re configuring Momento in our serverless applications. First, we&#x27;ll take a look at the Lambda function lifecycle and the concept of cold starts. Then, we&#x27;ll learn about how to reuse resources within Lambda despite its general statelessness.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="lambda-lifecycle-and-cold-starts">Lambda lifecycle and cold starts<a class="hash-link" href="#lambda-lifecycle-and-cold-starts" title="Direct link to heading">​</a></h3><p>To understand some of the choices we make in our code, we need to understand a bit more about how the Lambda lifecycle works.</p><p>As discussed in the previous step, AWS Lambda is event-driven, function-based compute. The first part, event-driven, means that your function is only executed in response to a configured event. There are a number of events you can configure for your Lambda function, from HTTP requests in API Gateway to queue messages in Amazon SQS to a batch of stream records in Amazon Kinesis. Upon the occurrence of your configured event, Lambda will invoke an instance of your code with details of the event. Your function instance will then handle the given event.</p><p><img loading="lazy" alt="Lambda event-driven compute" src="/assets/images/lambda_event_driven-07e15488d31f8ce8c63b3e0de019b68b.png" width="1000" height="796" class="img_E7b_"></p><p>When we say Lambda is <em>function-based compute</em>, we&#x27;re talking about how Lambda manages and executes your code. In creating a Lambda function, you upload a ZIP file or a container image that includes your code. You also specify an entrypoint handler for your function, which is an exported function in a specific file.</p><p>The interesting part is when these two elements combine. Lambda doesn&#x27;t keep live instances of your function running by default. Rather, it dynamically creates them as needed.</p><p>For example, when you make a POST request to your /users path to create a new User, API Gateway will route the event to your createUser Lambda function to handle the request. The first time you make this request, there won&#x27;t be a function instance available, so the Lambda service will create a new instance of your function by downloading your code, loading it into memory, and executing it.</p><p><img loading="lazy" alt="Lambda cold start" src="/assets/images/lambda_cold_start-1f33e835c4a6d719c023de9b17e5f316.png" width="1030" height="840" class="img_E7b_"></p><p>This process takes time -- there&#x27;s the data transfer to actually download the code to an AWS-managed instance, plus the time to read your code from disk, resolve the dependencies, and load the objects into memory. This initial set up time is called a <em>cold start</em> and can add anywhere from 30 milliseconds to a few seconds of latency to your function, depending on a variety of factors. Most optimized applications take less than a few hundred milliseconds for a cold start.</p><p>However, in order to enhance efficiency, the Lambda service doesn&#x27;t create a new function instance for every event that triggers your function. Once a function instance has been created to respond to an event, the Lambda service keeps that function instance running and available for subsequent requests. If a new request comes in, the service will use this idle, running Lambda function instance rather than creating a new instance and waiting for the cold start.</p><p><img loading="lazy" alt="Lambda function instance reuse" src="/assets/images/lambda_instance_reuse-669c1d5b18f9e77d457c6f89835a89e0.png" width="1030" height="840" class="img_E7b_"></p><p>Note that each Lambda function instance will handle at most one event at any given time. Thus, if an event comes in while all existing Lambda function instances are busy handling other events, the Lambda service will spin up a new function instance to handle the event.</p><p><img loading="lazy" alt="Lambda function second instance" src="/assets/images/lambda_second_instance-3d30b6abc5c383cb79f857c5f4b951b2.png" width="1030" height="840" class="img_E7b_"></p><p>There are a few key takeaways here. First, the Lambda service is dynamic -- it will create and destroy function instances according to the amount of traffic you have. If you get a burst of events triggering your Lambda function, the service will spin up multiple function instances to handle each request.</p><p>Second, the initial invocation for any particular Lambda function instance will take longer due to the initialization required. This includes downloading your function code, loading the code into memory, and starting the function instance. This additional latency on the initial request to a function instance is commonly called a &quot;coldstart&quot;.</p><p>Finally, a Lambda function instance can only handle a single event at a time, but the instance might handle multiple requests over a period of time. The Lambda service will keep running instances available after creation in order to rapidly serve subsequent requests. After a period of non-activity, the service may destroy running function instances.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="service-code-and-object-reuse">Service code and object reuse<a class="hash-link" href="#service-code-and-object-reuse" title="Direct link to heading">​</a></h3><p>In the previous step, we looked at the handler code for one of our Lambda functions. One thing we noted was that the handler code was pretty sparse -- it gathered the input to our function, and it returned an output in the expected shape, but most of the work was done via an AccountService class instance.</p><p>Let&#x27;s take a look at our AccountService code now. In the <code>src/accounts</code> directory, there is a <code>service.js</code> file which contains our AccountService definition. The code should look as follows:</p><p><img loading="lazy" alt="AccountService class" src="/assets/images/account_service-8934c22bc81b617cc8407dedea06a0f2.png" width="1189" height="646" class="img_E7b_"></p><p>The AccountService implementation is pretty straightforward. The AccountService is implemented as a class, which takes in a DynamoDB client in its constructor. It then has various methods, such as <code>createUser</code>, <code>getUser</code>, <code>createOrganization, getOrganization</code>, that will be used to access and manipulate data across this domain. Nothing is too special about this -- in most senses, a serverless application is just like a normal application.</p><p>Navigate to the bottom of the <code>service.js</code> file, where you will see the following:</p><p><img loading="lazy" alt="getAccountService method" src="/assets/images/get_account_service-a45fc0a0b2a1c4df322d60256f35a0c7.png" width="956" height="570" class="img_E7b_"></p><p>Notice that there is an exported <code>getAccountService</code> function. Above the function, there is a global <code>service</code> variable that is initialized to <code>null</code>. Within the <code>getAccountService</code> function, it returns the <code>service</code> variable if it has been initialized. If not, it initializes an instance of the service, assigns it to the <code>service</code> variable for future use, and returns it to the caller.</p><p>Notice that within the getAccountService function, it is calling a <code>getDynamoDBClient</code> function. If you look at the <code>src/clients/dynamodb.js</code> file for the details of that function, you can see a similar pattern as the AccountService instance, where we reuse a single instance of the client.</p><p><img loading="lazy" alt="getDynamoDBClient code" src="/assets/images/get_dynamodb_client-0ba029a429b6f10a4f3d6a1362eae017.png" width="567" height="487" class="img_E7b_"></p><p>So, why are we centralizing client creation, and why are we creating a single instance of a client?</p><p>Centralizing client creation is a pattern you might use regardless of your deployment environment, as it simplifies setting configuration values that are common across all users of your client. But using a single instance of our client is an optimization specific to AWS Lambda and its runtime model.</p><p>Remember the notes about the Lambda lifecycle in the section above. While a function instance can only handle a single request at a time, the same function instance might serve multiple requests over its lifetime.</p><p>While a Lambda function is generally stateless from request to request, you can take advantage of the reuse of a single Lambda function instance to improve performance of your application. When your Lambda function is invoked, everything within the handler function is new on each request. However, variables <em>outside</em> the function, in the global variable scope, can be reused across requests.</p><p><img loading="lazy" alt="Lambda global variable example" src="/assets/images/lambda_global_variable-64a53bfa7276d361ffa1b1ab6ccb5247.png" width="1146" height="531" class="img_E7b_"></p><p>In the image above, the variables within our handler are reset on each invocation to our Lambda function. However, the global <code>counter</code> variable is persistent across invocations. We can use this strategically to reuse variables, particularly service clients.</p><p>When using a service that requires a network request, a large portion of the initial request time is in establishing a connection with the remote service. You have to open a socket, perform TCP handshake and maybe a TLS handshake before you can start sending and receiving data. This process takes time and is comparable to the &#x27;coldstart&#x27; you face with your Lambda function.</p><p>Just like Lambda reuses function instances to amortize the cost of function initialization over many invocations, we want to reuse our client instance to amortize the cost of connection initialization. Thus, we create our service clients in a global variable space, allowing us to reuse the client and its corresponding connection, reducing latency in subsequent requests to our services.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="installing-and-configuring-momento-in-your-serverless-application">Installing and configuring Momento in your serverless application<a class="hash-link" href="#installing-and-configuring-momento-in-your-serverless-application" title="Direct link to heading">​</a></h2><p>With our concepts out of the way, let&#x27;s get down to the details of configuring Momento for use in our serverless application. We&#x27;ll go through three steps:</p><ul><li><p>Signing up for Momento and getting an authentication token;</p></li><li><p>Storing our authentication token in AWS Secrets Manager;</p></li><li><p>Installing and configuring our Momento client.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="signing-up-for-momento-and-getting-an-authentication-token">Signing up for Momento and getting an authentication token<a class="hash-link" href="#signing-up-for-momento-and-getting-an-authentication-token" title="Direct link to heading">​</a></h3><p>The first step is to sign up for the Momento service and get our authentication token. The authentication token must be included on requests to the Momento service to authenticate and authorize our requests.</p><p>To get a Momento token, you first need to install the Momento CLI. You can do so with Homebrew using the following commands:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">brew tap momentohq/tap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install momento-cli</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, provision a token with the <code>account signup</code> command:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">momento account signup --region us-west-2 --email your-email@example.com</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to use the region and email address you want to use for your Momento account. You will receive an email with your Momento access token.</p><p>Once you have your token, configure it in your CLI with the <code>momento configure</code> command.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">$ momento configure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: // &lt; Enter token from email here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Cache [default-cache]: accounts-cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Ttl Seconds [600]: 30</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enter the token into the command, and use a cache named <code>accounts-cache</code> as your default cache.</p><p>For more on getting started with Momento, you can follow the <a href="/docs/getting-started">getting started guide</a>. You can also learn more about the Momento authentication token in the <a href="/docs/how-it-works/momento-concepts#authentication-token">Momento Concepts</a> material.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="storing-our-authentication-token-in-aws-secrets-manager">Storing our authentication token in AWS Secrets Manager<a class="hash-link" href="#storing-our-authentication-token-in-aws-secrets-manager" title="Direct link to heading">​</a></h3><p>Now that we have our Momento authentication token, we need to make it accessible to our serverless application.</p><p>If you look at our <code>serverless.yml</code> file, we are able to inject environment variables into our function at runtime using the <code>environment</code> property in the <code>provider</code> block. However, environment variables are not recommended for storing sensitive values like API keys and other secrets as they can easily be accessed by compromised third-party dependencies in our application.</p><p>Instead, we&#x27;ll use AWS Secrets Manager. AWS Secrets Manager is a dedicated service for handling your secrets with fine-grained permissions and automated secret rotation. We can then retrieve the secret from our Lambda functions using the Secrets Manager API.</p><p>Navigate to the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">AWS Secrets Manager section of the AWS console</a>. Make sure you are in the same region you used for your serverless application. Then, click the <strong>Store a new secret</strong> button to add a new secret to Secrets Manager.</p><p><img loading="lazy" alt="AWS Secrets Manager homepage" src="/assets/images/secrets_manager-6f608f64698de5d0a50763c2ef301141.png" width="1264" height="520" class="img_E7b_"></p><p>This will open the Secrets Manager wizard for creating a new secret.</p><p>For the <strong>Secret type</strong>, select &quot;<strong>Other type of secret</strong>&quot;. Then, enter &quot;<strong>MOMENTO_AUTH_TOKEN</strong>&quot; for your secret key and paste your authentication token as the secret value.</p><p>You can keep the default encryption key. Click the <strong>Next</strong> button to continue the wizard.</p><p><img loading="lazy" alt="Creating a secret in Secrets Manager" src="/assets/images/create_secret-bcc6b30645e7f1ec290d37ef993ee000.png" width="819" height="836" class="img_E7b_"></p><p>On the next screen, give your secret a <strong>Secret name</strong> of &quot;<strong>accounts/MomentoAuthToken</strong>&quot; and enter a quick description of the secret. Then, click <strong>Next.</strong></p><p><img loading="lazy" alt="Store secret in Secrets Manager" src="/assets/images/store_secret-8c1c03f2ef614f100acbcb086af4b919.png" width="801" height="945" class="img_E7b_"></p><p>The next screen handles secret rotation, which we will not set up here. Click <strong>Next</strong> to continue to the final screen.</p><p>On the final page, click the <strong>Store</strong> button to confirm storage of your secret.</p><p>You should now see your secret listed on the Secrets Manager page:</p><p><img loading="lazy" alt="List of secrets in Secret Manager" src="/assets/images/secrets_list-3d0a3f9b353a836caa09030b12378906.png" width="1005" height="340" class="img_E7b_"></p><p>Now that we have stored our secret in AWS Secrets Manager, let&#x27;s configure a Momento client in our serverless application.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="installing-and-configuring-our-momento-client">Installing and configuring our Momento client<a class="hash-link" href="#installing-and-configuring-our-momento-client" title="Direct link to heading">​</a></h3><p>The final part of this step is to install the Momento SDK and create a client to use in our application. You can make the edits to the application yourself, or you can see the final version for this step using the <code>step-2</code> branch of the tutorial repository (TODO LINK).</p><p>Let&#x27;s start by installing the Momento SDK. We&#x27;re using Node.js for our application, so we can install the Momento SDK using npm:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">npm install @momento/sdk</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Because we installed the package and added it to our <code>package.json</code> file, the Serverless Framework will include it with our Node dependencies in the ZIP files for our Lambda functions.</p><p>Note: If you are using a language other than Node for your serverless application, the same basic approach applies. However, if you are using Python, be sure to compile the Python SDK for the Lambda environment as it includes a gRPC library with C extensions. You can find instructions on this in our guide for <a href="/docs/guides/caching-with-AWS-lambda#python">using Momento with AWS Lambda</a>.</p><p>With our SDK installed, we can now create and configure our client.</p><p>In the <code>src/clients</code> directory, create a directory called <code>momento.js</code> with the following contents:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">const AWS = require(&quot;aws-sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const { SimpleCacheClient } = require(&quot;@momento/sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MOMENTO_SECRET_ID = &quot;accounts/MomentoAuthToken&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MOMENTO_DEFAULT_TTL = 60;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let client = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getMomentoClient = async () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (client) return client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const token = await getMomentoAuthToken();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client = new SimpleCacheClient(token, MOMENTO_DEFAULT_TTL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getMomentoAuthToken = async () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const sm = new AWS.SecretsManager({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpOptions: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      connectTimeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await sm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getSecretValue({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecretId: MOMENTO_SECRET_ID,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return JSON.parse(response.SecretString).MOMENTO_AUTH_TOKEN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  getMomentoClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can see this follows a similar pattern as the DynamoDB client we reviewed earlier in this step. It creates an empty global variable, then hydrates that variable the first time the <code>getMomentoClient</code> function is called. Subsequent uses of the Momento client for that function instance will reuse the same client and thus benefit from existing connections.</p><p>Notice that we&#x27;re also calling out to AWS Secrets Manager to retrieve the Momento authentication token we stored. You could use the same client-reuse behavior for the Secrets Manager client that we use for the DynamoDB and Momento clients. However, because the Secrets Manager service will only be called once per function instance -- to help initialize the Momento client -- we can skip it in this case.</p><p>Now that we have added a way to create and retrieve our Momento cache client, let&#x27;s add the cache client to our AccountService class. We&#x27;ll inject a Momento cache client into our instance upon construction so that it can be used when needed by the class.</p><p>Navigate to the <code>src/accounts/service.js</code> file. Update the <code>constructor</code> method for your <code>AccountService</code> class so that it looks as follows:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">class AccountService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  constructor(dynamoDBClient, cacheClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this._dynamoDBClient = dynamoDBClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this._cacheClient = cacheClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally, we want to update our helper function to create and reuse the AccountService instance. Navigate to the bottom of the <code>src/accounts/service.js</code> file. Update the <code>getAccountService</code> function so it looks as follows:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">module.exports.getAccountService = async (props) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (service) return service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let dynamoDBClient = (props || {}).dynamoDBClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dynamoDBClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamoDBClient = getDynamoDBClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let cacheClient = (props || {}).cacheClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!cacheClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheClient = await getMomentoClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service = new AccountService(dynamoDBClient, cacheClient);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the function is injecting a cache client instance into our AccountService instance to satisfy the constructor. The caller of the getAccountService function can provide their own cache client, which can help with testing, but the default behavior is to fetch our reused cache instance with the <code>getMomentoClient</code> function we just implemented.</p><p>You&#x27;ll need to import this function into our service module, so add the following import to the top of the <code>src/accounts/service.js</code> file:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">const { getMomentoClient } = require(&quot;../clients/momento&quot;);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Further, <code>getAccountService()</code> is now an async function, as the call to <code>getMomentoClient</code> is async given that we may need to make a call to AWS Secrets Manager. In each of your handler functions, make sure you update them to <code>await</code> the call to <code>getAccountService()</code>.</p><p>Below is an example from the <code>createUser</code> handler:</p><div class="language-javascript codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-javascript codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lastName </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> accountService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccountService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> accountService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, we need to make some small updates to our <code>serverless.yml</code> file. Our Lambda functions will be calling a new AWS service as part of our changes and thus will need updated IAM permissions that grant our functions the ability to do so.</p><p>First, find your secret in the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">AWS Secrets Manager console</a>. Copy the <strong>Secret ARN</strong> value for your secret.</p><p><img loading="lazy" alt="Secrets Manager ARN" src="/assets/images/secret_arn-16c1810a679febbefdc944dfe197e574.png" width="1208" height="422" class="img_E7b_"></p><p>In your <code>serverless.yml</code> file, there is an <code>iam</code> section within the <code>provider</code> block. Add a new IAM statement so that your iam section looks as follows:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">  iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      statements:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: &#x27;Allow&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:GetItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:PutItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:ConditionCheckItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !GetAtt &#x27;DynamoDBTable.Arn&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &quot;secretsmanager:GetSecretValue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;&lt;yourSecretArn&gt;&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace &quot;<!-- -->&lt;<!-- -->yourSecretArn&gt;&quot; with the Secret ARN that you copied from the AWS console.</p><p>We also want to tell our application the name of the cache we created in Momento. Because this is not a sensitive value, we can inject it as an environment variable.</p><p>In the environment section within the provider block, update your application secrets to include the cache name as follows:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TABLE_NAME: !Ref DynamoDBTable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME: &#x27;accounts-cache&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our Momento client can use this environment variable to interact with the correct cache in our Momento account.</p><p>That&#x27;s it! You have now installed and configured a Momento client in your serverless application.</p><p>In the next step of this tutorial, we&#x27;ll see how to use our client by implementing a read-aside caching strategy in our application.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/alexdebrie/momento-docs/tree/main/docs/6-serverless-cache-walkthrough/3-configuring-momento.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/serverless-cache-walkthrough/deploying-a-basic-serverless-application"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploying a basic serverless application</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/serverless-cache-walkthrough/read-aside-caching-with-momento"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Read-aside caching with Momento</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-concepts-about-the-lambda-runtime-model" class="table-of-contents__link toc-highlight">Key concepts about the Lambda runtime model</a><ul><li><a href="#lambda-lifecycle-and-cold-starts" class="table-of-contents__link toc-highlight">Lambda lifecycle and cold starts</a></li><li><a href="#service-code-and-object-reuse" class="table-of-contents__link toc-highlight">Service code and object reuse</a></li></ul></li><li><a href="#installing-and-configuring-momento-in-your-serverless-application" class="table-of-contents__link toc-highlight">Installing and configuring Momento in your serverless application</a><ul><li><a href="#signing-up-for-momento-and-getting-an-authentication-token" class="table-of-contents__link toc-highlight">Signing up for Momento and getting an authentication token</a></li><li><a href="#storing-our-authentication-token-in-aws-secrets-manager" class="table-of-contents__link toc-highlight">Storing our authentication token in AWS Secrets Manager</a></li><li><a href="#installing-and-configuring-our-momento-client" class="table-of-contents__link toc-highlight">Installing and configuring our Momento client</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Documentation Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/3HkAKjUZGq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Momento, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ee4614db.js"></script>
<script src="/assets/js/main.26e96dc6.js"></script>
</body>
</html>