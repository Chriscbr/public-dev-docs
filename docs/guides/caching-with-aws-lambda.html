<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/caching-with-aws-lambda">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Momento Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Momento Docs Atom Feed">




<!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-THBDHDQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><title data-rh="true">Caching with AWS Lambda | Momento Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://momentohq.github.io/docs/guides/caching-with-aws-lambda"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Caching with AWS Lambda | Momento Docs"><meta data-rh="true" name="description" content="The release of AWS Lambda in November 2014 kicked off the serverless revolution in software architecture. Lambda&#x27;s event-driven, function-based compute solution changed the nature of how we build applications in the cloud."><meta data-rh="true" property="og:description" content="The release of AWS Lambda in November 2014 kicked off the serverless revolution in software architecture. Lambda&#x27;s event-driven, function-based compute solution changed the nature of how we build applications in the cloud."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://momentohq.github.io/docs/guides/caching-with-aws-lambda"><link data-rh="true" rel="alternate" href="https://momentohq.github.io/docs/guides/caching-with-aws-lambda" hreflang="en"><link data-rh="true" rel="alternate" href="https://momentohq.github.io/docs/guides/caching-with-aws-lambda" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b47816ea.css">
<link rel="preload" href="/assets/js/runtime~main.8b85dfa6.js" as="script">
<link rel="preload" href="/assets/js/main.61cf484c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Blog</a><a href="https://github.com/momentohq/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Github</a><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-title">Table of Contents</span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-overview"><a class="menu__link" href="/docs/overview">Momento</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-getting-started"><a class="menu__link" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-how-it-works"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/how-it-works">How it works</a><button aria-label="Toggle the collapsible sidebar category &#x27;How it works&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-caching-concepts"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/caching-concepts">Caching Concepts</a><button aria-label="Toggle the collapsible sidebar category &#x27;Caching Concepts&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-api-reference"><a class="menu__link" href="/docs/API-reference">API Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/guides">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guides/caching-with-aws-lambda">Caching with AWS Lambda</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/serverless-cache-walkthrough">Walkthrough - Adding a cache to a serverless application</a><button aria-label="Toggle the collapsible sidebar category &#x27;Walkthrough - Adding a cache to a serverless application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/guides"><span itemprop="name">Guides</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Caching with AWS Lambda</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Caching with AWS Lambda</h1><p>The release of AWS Lambda in November 2014 kicked off the serverless revolution in software architecture. Lambda&#x27;s event-driven, function-based compute solution changed the nature of how we build applications in the cloud.</p><p>However, Lambda&#x27;s compute model is quite different from the instance-based or even container-based models that came before it. It is hyper-ephemeral, as function instances are spun up on demand as needed to handle incoming events. This means you need to optimize for quick startup of your function instances and remove anything that could add to cold-start latency.</p><p>Further, Lambda is a stateless model where function instances can be removed as needed based on your application traffic. This means you can&#x27;t assume a running instance will be available, but you can optimize your code so that requests to an existing container will be faster than those from a cold start.</p><p>In this guide, we will look at practical aspects of using Momento in AWS Lambda. Specifically, we&#x27;ll cover three aspects of efficient use of Momento in Lambda:</p><ul><li><p><a href="#connection-reuse">Connection reuse</a>;</p></li><li><p><a href="#credential-management">Credential management</a>;</p></li><li><p><a href="#package-management">Package management</a>.</p></li></ul><p>This is designed to be a dense, practical guide on getting Momento configured in your serverless application.</p><p>If you want to know more about why Momento works well with serverless applications, please refer to our <a href="/docs/how-it-works/caching-with-serverless">guide on Caching with Serverless</a>.</p><p>If you want a deeper tutorial of how Lambda works and how to use Momento in your Lambda-based application, check out our in-depth tutorial on adding a cache to your serverless application.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="connection-reuse">Connection reuse<a class="hash-link" href="#connection-reuse" title="Direct link to heading">​</a></h2><p>The first step to using Momento well in your serverless application is to make sure you&#x27;re reusing your connection to the Momento service in your Lambda function. We&#x27;ll describe some background first, then give you the practical steps to take in your application.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">​</a></h3><p>Recall that Lambda is a stateless, function-based, event-driven compute model. Often, your Lambda function handler will look something like the following:</p><p><img loading="lazy" alt="Code for example Lambda handler" src="/assets/images/lambda-handler-26dc2ee0dffcdc4acfdc3d059b091ed2.png" title="Lambda handler example" width="1023" height="527" class="img_E7b_"></p><p>You will have a handler that serves as the entrypoint to your Lambda function. Whenever you have a configured event arrive, such as an HTTP request, an SQS queue message, or a batch of stream records, an instance of your Lambda function will receive the event and invoke your handler with the details of the event.</p><p>The important thing to note is that everything within the scope of your handler will be new each time. For example, in our handler, we have a counter variable that is both initialized and incremented within the handler:.</p><p><img loading="lazy" alt="Code with example Lambda handler and local variables" src="/assets/images/handler-local-variable-a0bde0b12af7a13240ebe6dbf9a6b3a6.png" title="Lambda handler with local variables" width="1023" height="527" class="img_E7b_"></p><p>However, because the variable is within the scope of the handler, it is not persisted across requests. Each time we invoke this specific function instance, the counter variable will be set to 1, but the count will be lost once the handler is finished executing for an event.</p><p>We can reuse state within a function instance if we want. If we set our variable in the global scope, outside of our handler scope, the variable will be retained across function instances.</p><p><img loading="lazy" alt="Code with example Lambda handler and global variable" src="/assets/images/global-variable-64a53bfa7276d361ffa1b1ab6ccb5247.png" title="Lambda handler with global variable" width="1146" height="531" class="img_E7b_"></p><p>In the image above, we&#x27;ve set the counter variable in the global scope. Now, each invocation of this function instance will increment that counter and the aggregated data will be retained across requests.</p><p>Note that this state is still retained within a specific instance of our Lambda function. The Lambda service may spin up multiple instances of your Lambda function if you have multiple, concurrent events that trigger your function at the same time. Data will be shared across requests to a single function instance across time but not across function instances.</p><p><img loading="lazy" alt="Architecture diagram with pool of Lambda functions" src="/assets/images/lambda-pool-c22a1eea76466c7deb1e351dda7ecb09.png" title="Lambda pool" width="1120" height="980" class="img_E7b_"></p><p>For example, in the image above, there are three separate instances of our Lambda function running. Multiple users are making HTTP requests to our function, and each function can handle only a single request at a time. However, once a function instance is initialized, it can be reused for multiple requests over time. You can see that each function instance has a counter variable, each with a different value based on the state of that individual function instance.</p><p>While this variable reuse can be helpful for things like counters, it is more commonly used for reusing things that can take a long time to initialize. If you are making network calls to external services like Momento in your Lambda function, establishing the initial connection can be the slowest part of your request. You will need to do both the TCP handshake to connect to the remote server and the TLS handshake to set up TLS encryption. This can easily take 100 milliseconds or more. Given that Momento has client-side latency of 1-2 milliseconds, this can defeat all of the gains from our caching!</p><p>However, we can take advantage of Lambda&#x27;s global variable reuse to cache our Momento client. Our first invocation within a specific function instance will take the time to establish the connection to Momento, but all subsequent invocations within that instance will be able to reuse the connection and drastically reduce overall response time.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="application">Application<a class="hash-link" href="#application" title="Direct link to heading">​</a></h3><p>Now that we know the details on why connection reuse is necessary in Lambda, let&#x27;s get to the specifics of how it works.</p><p>Remember that anything in the global scope will be reused across requests. This means you could initialize your Momento client in the global scope of your handler as follows:</p><p><img loading="lazy" alt="Code example with a global Momento client" src="/assets/images/global-momento-client-9b4a270116e96bf47307c56c33d97136.png" title="Global Momento client" width="1260" height="857" class="img_E7b_"></p><p>While this can work, it adds a lot of boilerplate to each function handler in your application. Additionally, it means your configuration logic is replicated across multiple different files rather than centralized in a single file.</p><p>I prefer to create a separate file for initializing my Momento client, as follows:</p><p><img loading="lazy" alt="Code example for Momento client module" src="/assets/images/momento-client-module-9a2a079b9c6e77777636aaa4db6221c2.png" title="Momento client module" width="1148" height="497" class="img_E7b_"></p><p>Notice that we have a <code>client</code> variable in the global scope of this module. Then, we have a <code>getMomentoClient</code> function that is exported from the module. Within that function, we first check if the <code>client</code> variable is null and return it if not. Otherwise, we initialize a Momento client and save it to the <code>client</code> variable. Then, we return the client to the caller.</p><p>This module will be loaded by our handler when our function instance is initialized. The first time a client calls the <code>getMomentoClient</code> function, there will not be an existing client available and one will be initialized. However, future requests will get a previously initialized client that has an existing connection to the Momento service, resulting in faster requests.</p><p>You can use this in your handler function or service class as follows:</p><p><img loading="lazy" alt="Code example for using Momento client module" src="/assets/images/momento-client-usage-77c88fbc1b37fd6c1e168158e2c482ad.png" title="Momento client usage" width="1411" height="561" class="img_E7b_"></p><p>While the example here is in Node.js, the same pattern will apply to other programming languages.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="credential-management">Credential management<a class="hash-link" href="#credential-management" title="Direct link to heading">​</a></h2><p>Momento uses a JWT to authenticate your client to the Momento service. In this section, we&#x27;ll talk about how to manage this token in AWS Lambda.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="background-1">Background<a class="hash-link" href="#background-1" title="Direct link to heading">​</a></h3><p>As discussed above, Lambda is a stateless compute environment. This means all data used within your application must be either built directly into your function code or must be dynamically loaded at runtime into your application. Building data directly into your code can work for specific bits of data but is less flexible than needed for other bits of data.</p><p>There are two main options for handling more dynamic data in your code. For non-sensitive information, you can inject data into your function code via environment variables. This works well for data that changes across stages in your application, such as the names of DynamoDB tables or S3 buckets. It can also work well for slight configuration differences across environments, such as the log level or feature-flagging behavior of your application.</p><p>However, environment variables do not work as well for sensitive information. All environment variables can be accessed by your application code, and this means compromised third-party libraries could easily read and capture your sensitive credentials.</p><p>To manage credentials, AWS Lambda users generally turn to one of two services: <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank" rel="noopener noreferrer">AWS Systems Manager Parameter Store</a>, or <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html" target="_blank" rel="noopener noreferrer">AWS Secrets Manager</a>.</p><p>These two systems are quite similar. Both provide a simple API for storing and receiving credentials and integrate with IAM to manage permissions. Secrets Manager is a more advanced solution that provides higher request limits, automated credential rotation, and more fine-grained access control.</p><p>For these advanced features, you pay both for each secret you store and for API calls to the Secrets Manager service. Conversely, Parameter Store is free to use but has lower per-second request limits and no automated credential rotation.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="application-1">Application<a class="hash-link" href="#application-1" title="Direct link to heading">​</a></h3><p>Now that we know a bit about secret management in AWS Lambda, let&#x27;s see how to store and manage our Momento authentication token in Lambda.</p><p>The application portion of credential management has three components:</p><ol><li><p>Storing the Momento authentication token in Secrets Manager;</p></li><li><p>Granting the needed IAM permissions for a Lambda function to access the secret;</p></li><li><p>Accessing the secret within your Lambda function.</p></li></ol><p>Let&#x27;s handle these in order.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="storing-the-momento-authentication-token-in-secrets-manager">Storing the Momento authentication token in Secrets Manager<a class="hash-link" href="#storing-the-momento-authentication-token-in-secrets-manager" title="Direct link to heading">​</a></h4><p>First, we need to store our Momento authentication token in AWS Secrets Manager.</p><p>Navigate to the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">AWS Secrets Manager section of the AWS console</a>. Make sure you are in the same region you use for your serverless application. Then, click the <strong>Store a new secret</strong> button to add a new secret to Secrets Manager.</p><p><img loading="lazy" alt="Example showing how to start storing a new secret in AWS Secrets Manager" src="/assets/images/secrets-manager-creation-6f608f64698de5d0a50763c2ef301141.png" title="Secrets Manager creation" width="1264" height="520" class="img_E7b_"></p><p>This will open the Secrets Manager wizard for creating a new secret.</p><p>For the <strong>Secret type</strong>, select &quot;<strong>Other type of secret</strong>&quot;. Then, enter &quot;<strong>MOMENTO_AUTH_TOKEN</strong>&quot; for your secret key and paste your authentication token as the secret value.</p><p>You can keep the default encryption key. Click the <strong>Next</strong> button to continue the wizard.</p><p><img loading="lazy" alt="Example showing how to store a new secret in Secrets Manager" src="/assets/images/secrets-manager-store-new-secret-bcc6b30645e7f1ec290d37ef993ee000.png" title="Secrets Manager Store a new secret" width="819" height="836" class="img_E7b_"></p><p>On the next screen, give your secret a name to identify the secret. and enter a quick description of the secret. Then, click <strong>Next.</strong></p><p><img loading="lazy" alt="Example showing how to name and describe secret in Secrets Manager" src="/assets/images/secrets-manager-name-and-description-f81c4bbf483e60b584845ac96d911bc4.png" title="Secrets Manager Name and Description" width="869" height="936" class="img_E7b_"></p><p>The next screen handles secret rotation, which we will not set up here. Click <strong>Next</strong> to continue to the final screen.</p><p>On the final page, click the <strong>Store</strong> button to confirm storage of your secret.</p><p>You should now see your secret listed on the Secrets Manager page:</p><p><img loading="lazy" alt="Example showing how to find secret in Secrets Manager" src="/assets/images/secrets-manager-list-secrets-770a46e4bb264356a4e9bd8dd1cf7cf8.png" title="Secrets Manager List Secrets" width="1118" height="331" class="img_E7b_"></p><p>Click on the secret name for your secret to open the detail screen for your secret.</p><p>In the <strong>Secret details</strong> section, there is a <strong>Secret ARN</strong> for your secret. Copy this value, as you will need it for the next step.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="granting-iam-permissions-to-access-your-secret">Granting IAM permissions to access your secret<a class="hash-link" href="#granting-iam-permissions-to-access-your-secret" title="Direct link to heading">​</a></h4><p>Now that we have configured the secret in AWS Secrets Manager, we need to grant permission for your AWS Lambda function to access the secret.</p><p>AWS Identify and Access Management (IAM) is the authorization system across all of AWS. When creating a Lambda function, your function will be associated with an IAM role that it will use to authenticate to various AWS services. You must grant permission for that IAM to access your Momento authentication token in order to retrieve the token from AWS Secrets Manager.</p><p>In general, the IAM statement you will need to configure will look as follows:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">- Effect: &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - &quot;secretsmanager:GetSecretValue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Resource: &quot;&lt;yourSecretArn&gt;&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace <strong>&quot;<!-- -->&lt;<!-- -->yourSecretArn&gt;&quot;</strong> with the Secret ARN you copied from the Secrets Manager console.</p><p>The mechanism you use to configure your IAM statements will depend on the deployment tooling you use for your Lambda functions.</p><p>If you are using the <a href="https://www.serverless.com/framework" target="_blank" rel="noopener noreferrer">Serverless Framework</a>, you can configure this permission by adding the following to the <strong>provider:</strong> block of your <strong>serverless.yml</strong> file:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">provider:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      statements:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &quot;secretsmanager:GetSecretValue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;&lt;yourSecretArn&gt;&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace <strong>&quot;<!-- -->&lt;<!-- -->yourSecretArn&gt;&quot;</strong> with the Secret ARN you copied from the Secrets Manager console.</p><p>If you are using <a href="https://aws.amazon.com/serverless/sam/" target="_blank" rel="noopener noreferrer">AWS SAM</a>, add the following in the <strong>Policies:</strong> section for each function that needs access to your Momento auth token:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">Policies:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Statement:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - Effect: &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          - &quot;secretsmanager:GetSecretValue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Resource: &quot;&lt;yourSecretArn&gt;&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace <strong>&quot;<!-- -->&lt;<!-- -->yourSecretArn&gt;&quot;</strong> with the Secret ARN you copied from the Secrets Manager console.</p><p>If you are using other deployment tooling, you can follow similar steps to attach permissions to the IAM role for your Lambda function.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="accessing-the-secret-in-your-lambda-function-code">Accessing the secret in your Lambda function code<a class="hash-link" href="#accessing-the-secret-in-your-lambda-function-code" title="Direct link to heading">​</a></h4><p>After you have configured permissions for your Lambda function to access the secret in AWS Secrets Manager, you can now access your Momento authentication token within your Lambda function.</p><p>To retrieve the secret from Secrets Manager, add code like the following to your application:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">const AWS = require(&quot;aws-sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getMomentoAuthToken = async () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const secretsmanager = new AWS.SecretsManager({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpOptions: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      connectTimeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await secretsmanager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getSecretValue({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecretId: &lt;yourSecretName&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return JSON.parse(response.SecretString).MOMENTO_AUTH_TOKEN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace <strong>&quot;<!-- -->&lt;<!-- -->yourSecretName&gt;&quot;</strong> with the name of the secret you used in the Secrets Manager console.</p><p>This code will create a client for accessing AWS Secrets Manager. Then, it will call the <code>GetSecretValue</code> action on the Secrets Manager service. Finally, it will parse the response and return the value for the configured MOMENTO_AUTH_TOKEN.</p><p>Notice that this will make an external network call, and thus you should optimize your Lambda code around this. Ideally, you are only constructing your SimpleCache object once within a given Lambda function instance, as discussed above in the <a href="#heading=h.rkchdfjttru6">Connection reuse section</a>. Because of this, you should only need to retrieve the Momento authentication token once within a particular function instance.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="package-management">Package management<a class="hash-link" href="#package-management" title="Direct link to heading">​</a></h2><p>The final piece of practical advice for using Momento in an AWS Lambda function is around package management. We&#x27;ll first discuss the Lambda compute environment, then we&#x27;ll discuss specifics around including the Momento SDK within your Lambda function.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="background-2">Background<a class="hash-link" href="#background-2" title="Direct link to heading">​</a></h3><p>AWS Lambda is a fully-managed, function-based compute environment. You will give Lambda a ZIP file with your function code (or, alternatively, <a href="https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/" target="_blank" rel="noopener noreferrer">a Docker container image</a>), and the Lambda environment will handle running your code in response to events.</p><p>As an application developer, there are two aspects you need to consider when using third-party dependencies in AWS Lambda.</p><p>First, you need to ensure that the dependency is included within your function ZIP file. Many deployment tools, including the <a href="https://www.serverless.com/framework" target="_blank" rel="noopener noreferrer">Serverless Framework</a>, <a href="https://aws.amazon.com/serverless/sam/" target="_blank" rel="noopener noreferrer">AWS SAM</a>, <a href="https://aws.amazon.com/cdk/" target="_blank" rel="noopener noreferrer">AWS CDK</a>, and <a href="https://arc.codes/docs/en/get-started/why-architect" target="_blank" rel="noopener noreferrer">Architect</a>, will assist you with dependency management. They will either build the dependencies for you as part of a deployment process, or they will create a ZIP file from the contents of your application directory. Specific details can be found below.</p><p>Second, you must ensure that your dependencies will work in the AWS Lambda environment. If you are using a ZIP file rather than a container image for your Lambda function, the code itself will be running on top of the Amazon Linux 2 operating system. Most of your function code and dependencies will work the same on your local machine as in the Lambda execution environment. However, certain dependencies must be compiled for specific architectures.</p><p>The <a href="/docs/how-it-works/momento-concepts#grpc">Momento SimpleCache clients use gRPC</a> to connect to the Momento service. The gRPC library for Python uses architecture-specific bindings and thus must be compiled for the Amazon Linux 2 execution environment. If you build the dependency directly on your Mac or Windows machine, it won&#x27;t be compatible with the Lambda execution environment.</p><p>Below, we will see how to handle both of these problems using popular deployment frameworks.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="application-2">Application<a class="hash-link" href="#application-2" title="Direct link to heading">​</a></h3><p>Now that we know the background on using dependencies within AWS Lambda, let&#x27;s see how to use the Momento SDK with different runtimes and deployment tooling.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="nodejs">Node.js<a class="hash-link" href="#nodejs" title="Direct link to heading">​</a></h4><p>If you are using Node.js for your Lambda functions, you don&#x27;t need to worry about compiling for a specific execution environment. The Momento SDK and all of its dependencies are pure JavaScript and will work across different architectures.</p><p>To add Momento to your Lambda function, you need to install it and save it to your <code>package.json</code> file:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">npm install --save @gomomento/sdk</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Most of the popular deployment tools will automatically include the installed package in your Lambda function ZIP file.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="python">Python<a class="hash-link" href="#python" title="Direct link to heading">​</a></h4><p>If you are using Python for your Lambda function, you need to ensure to compile the gRPC package for the Amazon Linux 2 execution environment. How you do so depends on your deployment tooling.</p><p>If you are using the Serverless Framework, you can use the <a href="https://github.com/serverless/serverless-python-requirements" target="_blank" rel="noopener noreferrer">serverless-python-requirements</a> plugin to assist in building and managing your Python requirements. The serverless-python-requirements package will integrate with your Python package manager of choice to build your Python dependencies when deploying your Lambda function. Importantly, you can choose to build your dependencies in a Docker container that matches the Lambda execution environment and thus will be built correctly.</p><p>To configure serverless-python-requirements, be sure to add the following configuration to your <code>serverless.yml</code> file:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">plugins:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - serverless-python-requirements</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">custom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pythonRequirements:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dockerizePip: true</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to read the rest of the <a href="https://github.com/serverless/serverless-python-requirements" target="_blank" rel="noopener noreferrer">documentation on serverless-python-requirements</a> to customize for your specific environment.</p><p>If you are using AWS SAM, you can use the following command to build your ZIP file properly for the Lambda execution environment:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#393A34"><span class="token plain">sam build --use-container</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-using-build.html#build-zip-archive" target="_blank" rel="noopener noreferrer">indicate to SAM that you want to use a Docker image</a> that is similar to the Lambda execution environment to build your dependencies.</p><p>If you are using the AWS CDK, it will <a href="https://docs.aws.amazon.com/cdk/api/v1/docs/aws-lambda-python-readme.html#packaging" target="_blank" rel="noopener noreferrer">install all dependencies in a Lambda-compatible Docker container</a> based on the Python package management tool of your choice.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="other-languages">Other languages<a class="hash-link" href="#other-languages" title="Direct link to heading">​</a></h4><p>For other languages, you should install the Momento SDK according to the installation instructions. Then, refer to the AWS Lambda documentation for building ZIP files for those languages:</p><ul><li><p><a href="https://docs.aws.amazon.com/lambda/latest/dg/java-package.html" target="_blank" rel="noopener noreferrer">Lambda Java deployment package</a></p></li><li><p><a href="https://docs.aws.amazon.com/lambda/latest/dg/golang-package.html" target="_blank" rel="noopener noreferrer">Lambda Golang deployment package</a></p></li><li><p><a href="https://docs.aws.amazon.com/lambda/latest/dg/csharp-package.html" target="_blank" rel="noopener noreferrer">Lambda C# deployment package</a></p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/momentohq/public-dev-docs/tree/main/docs/5-guides/1-caching-with-aws-lambda.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guides"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guides</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/serverless-cache-walkthrough"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Walkthrough - Adding a cache to a serverless application</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#connection-reuse" class="table-of-contents__link toc-highlight">Connection reuse</a><ul><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#application" class="table-of-contents__link toc-highlight">Application</a></li></ul></li><li><a href="#credential-management" class="table-of-contents__link toc-highlight">Credential management</a><ul><li><a href="#background-1" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#application-1" class="table-of-contents__link toc-highlight">Application</a></li></ul></li><li><a href="#package-management" class="table-of-contents__link toc-highlight">Package management</a><ul><li><a href="#background-2" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#application-2" class="table-of-contents__link toc-highlight">Application</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Documentation Home</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/3HkAKjUZGq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li><li class="footer__item"><a href="https://github.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/img/footer_logo.svg" alt="Momento Logo" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></div><div class="footer__copyright">Copyright © 2022 Momento, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8b85dfa6.js"></script>
<script src="/assets/js/main.61cf484c.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-THBDHDQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>