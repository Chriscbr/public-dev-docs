<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-develop/tutorials/serverless-cache-walkthrough/configuring-momento">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">サーバーレス環境にMomento を設定する | Momento Cache</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.momentohq.com/ja/develop/tutorials/serverless-cache-walkthrough/configuring-momento"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="サーバーレス環境にMomento を設定する | Momento Cache"><meta data-rh="true" name="description" content="In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application."><meta data-rh="true" property="og:description" content="In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application."><link data-rh="true" rel="icon" href="/ja/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.momentohq.com/ja/develop/tutorials/serverless-cache-walkthrough/configuring-momento"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/configuring-momento" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/ja/develop/tutorials/serverless-cache-walkthrough/configuring-momento" hreflang="ja"><link data-rh="true" rel="alternate" href="https://docs.momentohq.com/develop/tutorials/serverless-cache-walkthrough/configuring-momento" hreflang="x-default"><!-- Google Tag Manager -->
    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-THBDHDQ",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <!-- End Google Tag Manager --><link rel="stylesheet" href="/ja/assets/css/styles.b83cbc0f.css">
<link rel="preload" href="/ja/assets/js/runtime~main.26a36ed7.js" as="script">
<link rel="preload" href="/ja/assets/js/main.7bb27a3e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.gomomento.com/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/ja/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ja/img/logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">公式ブログ</a><a href="https://github.com/momentohq/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>日本語</a><ul class="dropdown__menu"><li><a href="/develop/tutorials/serverless-cache-walkthrough/configuring-momento" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li><li><a href="/ja/develop/tutorials/serverless-cache-walkthrough/configuring-momento" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="ja">日本語</a></li></ul></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="sidebar-title">Table of Contents</span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-overview"><a class="menu__link" href="/ja/">Momento サーバーレスキャッシュサービス</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/introduction/momento-topics">導入</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item sidebar-item-getting-started"><a class="menu__link" href="/ja/getting-started">まずはじめに</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item sidebar-item-api-reference"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/ja/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">開発</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">チュートリアル</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item sidebar-item-walkthrough"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">サーバーレスアプリケーションにキャッシュを追加</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/adding-a-cache-to-serverless">導入とセットアップ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/deploying-a-basic-serverless-application">基本的なサーバーレスアプリケーションをデプロイ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/configuring-momento">サーバーレス環境にMomento を設定する</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento">Momento でRead-aside キャッシュ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/ja/develop/tutorials/serverless-cache-walkthrough/write-aside-caching-with-momento">Momento でWrite-aside キャッシュ</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item sidebar-item-data-types"><a class="menu__link" tabindex="0" href="/ja/develop/datatypes">Data Types</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ja/develop/guides/caching-with-aws-lambda">ガイド</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed sidebar-item-limits"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ja/develop/sdks-integrations/momento-cache-laravel-php">SDKS and Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/ja/develop/api-reference">API reference</a><button aria-label="サイドバーのカテゴリー「API reference」を開く・閉じる" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-guides"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/learn/how-it-works">学ぶ</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed sidebar-item-limits"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ja/manage/pricing">管理</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/ja/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">開発</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">チュートリアル</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">サーバーレスアプリケーションにキャッシュを追加</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">サーバーレス環境にMomento を設定する</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">このページの見出し</button></div><div class="theme-doc-markdown markdown"><h1>Configuring Momento in Serverless</h1><p>In the previous step, we deployed a basic serverless application using AWS Lambda, API Gateway, and DynamoDB. With this, we implemented the basics of account management within our application.</p><p>In the next few steps, we&#x27;re going to add caching to our serverless application using Momento. The account management service will be heavily relied upon by other services, so we want to make sure it is fast and reliable. Using a cache will reduce latency and the load on our primary database.</p><p>In this step, we will sign up for the Momento service and configure it for usage in our serverless application. As we do so, we will learn more key concepts about using Lambda correctly, including some subtle details about the runtime model that make a big difference in performance. For this step, we&#x27;ll be using the <code>step-2</code> branch in the <a href="https://github.com/momentohq/serverless-tutorial/tree/step-2" target="_blank" rel="noopener noreferrer">tutorial repository</a>.</p><p>If you want to skip the concepts and go directly to the implementation, navigate ahead to the section on <a href="#installing-and-configuring-momento-in-your-serverless-application">installing and configuring Momento in your serverless application</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-concepts-about-the-lambda-runtime-model">Key concepts about the Lambda runtime model<a href="#key-concepts-about-the-lambda-runtime-model" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h2><p>Before we get to the implementation, we&#x27;re going to examine two concepts that will help us understand how we&#x27;re configuring Momento in our serverless applications. First, we&#x27;ll take a look at the Lambda function lifecycle and the concept of cold starts. Then, we&#x27;ll learn about how to reuse resources within Lambda despite its general statelessness.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lambda-lifecycle-and-cold-starts">Lambda lifecycle and cold starts<a href="#lambda-lifecycle-and-cold-starts" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h3><p>To understand some of the choices we make in our code, we need to understand a bit more about how the Lambda lifecycle works.</p><p>As discussed in the previous step, AWS Lambda is event-driven, function-based compute. The first part, event-driven, means that your function is only executed in response to a configured event. There are a number of events you can configure for your Lambda function, from HTTP requests in API Gateway to queue messages in Amazon SQS to a batch of stream records in Amazon Kinesis. Upon the occurrence of your configured event, Lambda will invoke an instance of your code with details of the event. Your function instance will then handle the given event.</p><p><img loading="lazy" alt="Lambda event-driven compute" src="/ja/assets/images/lambda_event_driven-07e15488d31f8ce8c63b3e0de019b68b.png" width="1000" height="796" class="img_ev3q"></p><p>When we say Lambda is <em>function-based compute</em>, we&#x27;re talking about how Lambda manages and executes your code. In creating a Lambda function, you upload a ZIP file or a container image that includes your code. You also specify an entrypoint handler for your function, which is an exported function in a specific file.</p><p>The interesting part is when these two elements combine. Lambda doesn&#x27;t keep live instances of your function running by default. Rather, it dynamically creates them as needed.</p><p>For example, when you make a POST request to your /users path to create a new User, API Gateway will route the event to your createUser Lambda function to handle the request. The first time you make this request, there won&#x27;t be a function instance available, so the Lambda service will create a new instance of your function by downloading your code, loading it into memory, and executing it.</p><p><img loading="lazy" alt="Lambda cold start" src="/ja/assets/images/lambda_cold_start-1f33e835c4a6d719c023de9b17e5f316.png" width="1030" height="840" class="img_ev3q"></p><p>This process takes time -- there&#x27;s the data transfer to actually download the code to an AWS-managed instance, plus the time to read your code from disk, resolve the dependencies, and load the objects into memory. This initial set up time is called a <em>cold start</em> and can add anywhere from 30 milliseconds to a few seconds of latency to your function, depending on a variety of factors. Most optimized applications take less than a few hundred milliseconds for a cold start.</p><p>However, in order to enhance efficiency, the Lambda service doesn&#x27;t create a new function instance for every event that triggers your function. Once a function instance has been created to respond to an event, the Lambda service keeps that function instance running and available for subsequent requests. If a new request comes in, the service will use this idle, running Lambda function instance rather than creating a new instance and waiting for the cold start.</p><p><img loading="lazy" alt="Lambda function instance reuse" src="/ja/assets/images/lambda_instance_reuse-669c1d5b18f9e77d457c6f89835a89e0.png" width="1030" height="840" class="img_ev3q"></p><p>Note that each Lambda function instance will handle at most one event at any given time. Thus, if an event comes in while all existing Lambda function instances are busy handling other events, the Lambda service will spin up a new function instance to handle the event.</p><p><img loading="lazy" alt="Lambda function second instance" src="/ja/assets/images/lambda_second_instance-3d30b6abc5c383cb79f857c5f4b951b2.png" width="1030" height="840" class="img_ev3q"></p><p>There are a few key takeaways here. First, the Lambda service is dynamic -- it will create and destroy function instances according to the amount of traffic you have. If you get a burst of events triggering your Lambda function, the service will spin up multiple function instances to handle each request.</p><p>Second, the initial invocation for any particular Lambda function instance will take longer due to the initialization required. This includes downloading your function code, loading the code into memory, and starting the function instance. This additional latency on the initial request to a function instance is commonly called a &quot;coldstart&quot;.</p><p>Finally, a Lambda function instance can only handle a single event at a time, but the instance might handle multiple requests over a period of time. The Lambda service will keep running instances available after creation in order to rapidly serve subsequent requests. After a period of non-activity, the service may destroy running function instances.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-code-and-object-reuse">Service code and object reuse<a href="#service-code-and-object-reuse" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h3><p>In the previous step, we looked at the handler code for one of our Lambda functions. One thing we noted was that the handler code was pretty sparse -- it gathered the input to our function, and it returned an output in the expected shape, but most of the work was done via an AccountService class instance.</p><p>Let&#x27;s take a look at our AccountService code now. In the <code>src/accounts</code> directory, there is a <code>service.js</code> file which contains our AccountService definition. The code should look as follows:</p><p><img loading="lazy" alt="AccountService class" src="/ja/assets/images/account_service-8934c22bc81b617cc8407dedea06a0f2.png" width="1189" height="646" class="img_ev3q"></p><p>The AccountService implementation is pretty straightforward. The AccountService is implemented as a class, which takes in a DynamoDB client in its constructor. It then has various methods, such as <code>createUser</code>, <code>getUser</code>, <code>createOrganization, getOrganization</code>, that will be used to access and manipulate data across this domain. Nothing is too special about this -- in most senses, a serverless application is just like a normal application.</p><p>Navigate to the bottom of the <code>service.js</code> file, where you will see the following:</p><p><img loading="lazy" alt="getAccountService method" src="/ja/assets/images/get_account_service-a45fc0a0b2a1c4df322d60256f35a0c7.png" width="956" height="570" class="img_ev3q"></p><p>Notice that there is an exported <code>getAccountService</code> function. Above the function, there is a global <code>service</code> variable that is initialized to <code>null</code>. Within the <code>getAccountService</code> function, it returns the <code>service</code> variable if it has been initialized. If not, it initializes an instance of the service, assigns it to the <code>service</code> variable for future use, and returns it to the caller.</p><p>Notice that within the getAccountService function, it is calling a <code>getDynamoDBClient</code> function. If you look at the <code>src/clients/dynamodb.js</code> file for the details of that function, you can see a similar pattern as the AccountService instance, where we reuse a single instance of the client.</p><p><img loading="lazy" alt="getDynamoDBClient code" src="/ja/assets/images/get_dynamodb_client-0ba029a429b6f10a4f3d6a1362eae017.png" width="567" height="487" class="img_ev3q"></p><p>So, why are we centralizing client creation, and why are we creating a single instance of a client?</p><p>Centralizing client creation is a pattern you might use regardless of your deployment environment, as it simplifies setting configuration values that are common across all users of your client. But using a single instance of our client is an optimization specific to AWS Lambda and its runtime model.</p><p>Remember the notes about the Lambda lifecycle in the section above. While a function instance can only handle a single request at a time, the same function instance might serve multiple requests over its lifetime.</p><p>While a Lambda function is generally stateless from request to request, you can take advantage of the reuse of a single Lambda function instance to improve performance of your application. When your Lambda function is invoked, everything within the handler function is new on each request. However, variables <em>outside</em> the function, in the global variable scope, can be reused across requests.</p><p><img loading="lazy" alt="Lambda global variable example" src="/ja/assets/images/lambda_global_variable-64a53bfa7276d361ffa1b1ab6ccb5247.png" width="1146" height="531" class="img_ev3q"></p><p>In the image above, the variables within our handler are reset on each invocation to our Lambda function. However, the global <code>counter</code> variable is persistent across invocations. We can use this strategically to reuse variables, particularly service clients.</p><p>When using a service that requires a network request, a large portion of the initial request time is in establishing a connection with the remote service. You have to open a socket, perform TCP handshake and maybe a TLS handshake before you can start sending and receiving data. This process takes time and is comparable to the &#x27;coldstart&#x27; you face with your Lambda function.</p><p>Just like Lambda reuses function instances to amortize the cost of function initialization over many invocations, we want to reuse our client instance to amortize the cost of connection initialization. Thus, we create our service clients in a global variable space, allowing us to reuse the client and its corresponding connection, reducing latency in subsequent requests to our services.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-and-configuring-momento-in-your-serverless-application">Installing and configuring Momento in your serverless application<a href="#installing-and-configuring-momento-in-your-serverless-application" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h2><p>With our concepts out of the way, let&#x27;s get down to the details of configuring Momento for use in our serverless application. We&#x27;ll go through three steps:</p><ul><li><p>Signing up for Momento and getting an authentication token;</p></li><li><p>Storing our authentication token in AWS Secrets Manager;</p></li><li><p>Installing and configuring our Momento client.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="signing-up-for-momento-and-getting-an-authentication-token">Signing up for Momento and getting an authentication token<a href="#signing-up-for-momento-and-getting-an-authentication-token" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h3><p>The first step is to sign up for the Momento service and get our authentication token. The authentication token must be included on requests to the Momento service to authenticate and authorize our requests.</p><p>To get a Momento token, you first need to install the Momento CLI. You can do so with Homebrew using the following commands:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">brew tap momentohq/tap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew install momento-cli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, provision a token with the <code>account signup</code> command:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">momento account signup --region us-west-2 --email your-email@example.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to use the region and email address you want to use for your Momento account. You will receive an email with your Momento access token.</p><p>Once you have your token, configure it in your CLI with the <code>momento configure</code> command.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ momento configure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Token: // &lt; Enter token from email here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Cache [default-cache]: accounts-cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default Ttl Seconds [600]: 30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enter the token into the command, and use a cache named <code>accounts-cache</code> as your default cache.</p><p>For more on getting started with Momento, you can follow the <a href="/ja/getting-started">getting started guide</a>. You can also learn more about the Momento authentication token in the <a href="/ja/learn/how-it-works#authentication-token">Momento Concepts</a> material.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="storing-our-authentication-token-in-aws-secrets-manager">Storing our authentication token in AWS Secrets Manager<a href="#storing-our-authentication-token-in-aws-secrets-manager" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h3><p>Now that we have our Momento authentication token, we need to make it accessible to our serverless application.</p><p>If you look at our <code>serverless.yml</code> file, we are able to inject environment variables into our function at runtime using the <code>environment</code> property in the <code>provider</code> block. However, environment variables are not recommended for storing sensitive values like API keys and other secrets as they can easily be accessed by compromised third-party dependencies in our application.</p><p>Instead, we&#x27;ll use AWS Secrets Manager. AWS Secrets Manager is a dedicated service for handling your secrets with fine-grained permissions and automated secret rotation. We can then retrieve the secret from our Lambda functions using the Secrets Manager API.</p><p>Navigate to the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">AWS Secrets Manager section of the AWS console</a>. Make sure you are in the same region you used for your serverless application. Then, click the <strong>Store a new secret</strong> button to add a new secret to Secrets Manager.</p><p><img loading="lazy" alt="AWS Secrets Manager homepage" src="/ja/assets/images/secrets_manager-6f608f64698de5d0a50763c2ef301141.png" width="1264" height="520" class="img_ev3q"></p><p>This will open the Secrets Manager wizard for creating a new secret.</p><p>For the <strong>Secret type</strong>, select &quot;<strong>Other type of secret</strong>&quot;. Then, enter &quot;<strong>MOMENTO_AUTH_TOKEN</strong>&quot; for your secret key and paste your authentication token as the secret value.</p><p>You can keep the default encryption key. Click the <strong>Next</strong> button to continue the wizard.</p><p><img loading="lazy" alt="Creating a secret in Secrets Manager" src="/ja/assets/images/create_secret-bcc6b30645e7f1ec290d37ef993ee000.png" width="819" height="836" class="img_ev3q"></p><p>On the next screen, give your secret a <strong>Secret name</strong> of &quot;<strong>accounts/MomentoAuthToken</strong>&quot; and enter a quick description of the secret. Then, click <strong>Next.</strong></p><p><img loading="lazy" alt="Store secret in Secrets Manager" src="/ja/assets/images/store_secret-8c1c03f2ef614f100acbcb086af4b919.png" width="801" height="945" class="img_ev3q"></p><p>The next screen handles secret rotation, which we will not set up here. Click <strong>Next</strong> to continue to the final screen.</p><p>On the final page, click the <strong>Store</strong> button to confirm storage of your secret.</p><p>You should now see your secret listed on the Secrets Manager page:</p><p><img loading="lazy" alt="List of secrets in Secret Manager" src="/ja/assets/images/secrets_list-3d0a3f9b353a836caa09030b12378906.png" width="1005" height="340" class="img_ev3q"></p><p>Now that we have stored our secret in AWS Secrets Manager, let&#x27;s configure a Momento client in our serverless application.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-and-configuring-our-momento-client">Installing and configuring our Momento client<a href="#installing-and-configuring-our-momento-client" class="hash-link" aria-label="この見出しへのリンク" title="この見出しへのリンク">​</a></h3><p>The final part of this step is to install the Momento SDK and create a client to use in our application. You can make the edits to the application yourself, or you can see the final version for this step using the <code>step-2</code> branch of the <a href="https://github.com/momentohq/serverless-tutorial/tree/step-2" target="_blank" rel="noopener noreferrer">tutorial repository</a>.</p><p>Let&#x27;s start by installing the Momento SDK. We&#x27;re using Node.js for our application, so we can install the Momento SDK using npm:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">npm install @gomomento/sdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Because we installed the package and added it to our <code>package.json</code> file, the Serverless Framework will include it with our Node dependencies in the ZIP files for our Lambda functions.</p><p>Note: If you are using a language other than Node for your serverless application, the same basic approach applies. However, if you are using Python, be sure to compile the Python SDK for the Lambda environment as it includes a gRPC library with C extensions. You can find instructions on this in our guide for <a href="/ja/develop/guides/caching-with-aws-lambda#python">using Momento with AWS Lambda</a>.</p><p>With our SDK installed, we can now create and configure our client.</p><p>In the <code>src/clients</code> directory, create a directory called <code>momento.js</code> with the following contents:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const AWS = require(&quot;aws-sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const { SimpleCacheClient } = require(&quot;@gomomento/sdk&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MOMENTO_SECRET_ID = &quot;accounts/MomentoAuthToken&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MOMENTO_DEFAULT_TTL = 60;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let client = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getMomentoClient = async () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (client) return client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const token = await getMomentoAuthToken();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  client = new SimpleCacheClient(token, MOMENTO_DEFAULT_TTL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return client;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const getMomentoAuthToken = async () =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const sm = new AWS.SecretsManager({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    httpOptions: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      connectTimeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      timeout: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const response = await sm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .getSecretValue({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      SecretId: MOMENTO_SECRET_ID,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .promise();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return JSON.parse(response.SecretString).MOMENTO_AUTH_TOKEN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module.exports = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  getMomentoClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can see this follows a similar pattern as the DynamoDB client we reviewed earlier in this step. It creates an empty global variable, then hydrates that variable the first time the <code>getMomentoClient</code> function is called. Subsequent uses of the Momento client for that function instance will reuse the same client and thus benefit from existing connections.</p><p>Notice that we&#x27;re also calling out to AWS Secrets Manager to retrieve the Momento authentication token we stored. You could use the same client-reuse behavior for the Secrets Manager client that we use for the DynamoDB and Momento clients. However, because the Secrets Manager service will only be called once per function instance -- to help initialize the Momento client -- we can skip it in this case.</p><p>Now that we have added a way to create and retrieve our Momento cache client, let&#x27;s add the cache client to our AccountService class. We&#x27;ll inject a Momento cache client into our instance upon construction so that it can be used when needed by the class.</p><p>Navigate to the <code>src/accounts/service.js</code> file. Update the <code>constructor</code> method for your <code>AccountService</code> class so that it looks as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class AccountService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  constructor(dynamoDBClient, cacheClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this._dynamoDBClient = dynamoDBClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this._cacheClient = cacheClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally, we want to update our helper function to create and reuse the AccountService instance. Navigate to the bottom of the <code>src/accounts/service.js</code> file. Update the <code>getAccountService</code> function so it looks as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module.exports.getAccountService = async (props) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (service) return service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let dynamoDBClient = (props || {}).dynamoDBClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dynamoDBClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dynamoDBClient = getDynamoDBClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let cacheClient = (props || {}).cacheClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!cacheClient) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cacheClient = await getMomentoClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  service = new AccountService(dynamoDBClient, cacheClient);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return service;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice that the function is injecting a cache client instance into our AccountService instance to satisfy the constructor. The caller of the getAccountService function can provide their own cache client, which can help with testing, but the default behavior is to fetch our reused cache instance with the <code>getMomentoClient</code> function we just implemented.</p><p>You&#x27;ll need to import this function into our service module, so add the following import to the top of the <code>src/accounts/service.js</code> file:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const { getMomentoClient } = require(&quot;../clients/momento&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Further, <code>getAccountService()</code> is now an async function, as the call to <code>getMomentoClient</code> is async given that we may need to make a call to AWS Secrets Manager. In each of your handler functions, make sure you update them to <code>await</code> the call to <code>getAccountService()</code>.</p><p>Below is an example from the <code>createUser</code> handler:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">handler</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lastName </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">body</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> accountService </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">getAccountService</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> accountService</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    username</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lastName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, we need to make some small updates to our <code>serverless.yml</code> file. Our Lambda functions will be calling a new AWS service as part of our changes and thus will need updated IAM permissions that grant our functions the ability to do so.</p><p>First, find your secret in the <a href="https://console.aws.amazon.com/secretsmanager/home" target="_blank" rel="noopener noreferrer">AWS Secrets Manager console</a>. Copy the <strong>Secret ARN</strong> value for your secret.</p><p><img loading="lazy" alt="Secrets Manager ARN" src="/ja/assets/images/secret_arn-16c1810a679febbefdc944dfe197e574.png" width="1208" height="422" class="img_ev3q"></p><p>In your <code>serverless.yml</code> file, there is an <code>iam</code> section within the <code>provider</code> block. Add a new IAM statement so that your iam section looks as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  iam:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    role:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      statements:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: &#x27;Allow&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:GetItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:PutItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &#x27;dynamodb:ConditionCheckItem&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: !GetAtt &#x27;DynamoDBTable.Arn&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - Effect: &quot;Allow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Action:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - &quot;secretsmanager:GetSecretValue&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Resource: &quot;&lt;yourSecretArn&gt;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Be sure to replace &quot;<!-- -->&lt;<!-- -->yourSecretArn&gt;&quot; with the Secret ARN that you copied from the AWS console.</p><p>We also want to tell our application the name of the cache we created in Momento. Because this is not a sensitive value, we can inject it as an environment variable.</p><p>In the environment section within the provider block, update your application secrets to include the cache name as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TABLE_NAME: !Ref DynamoDBTable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CACHE_NAME: &#x27;accounts-cache&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AWS_NODEJS_CONNECTION_REUSE_ENABLED: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Our Momento client can use this environment variable to interact with the correct cache in our Momento account.</p><p>That&#x27;s it! You have now installed and configured a Momento client in your serverless application.</p><p>In the next step of this tutorial, we&#x27;ll see how to use our client by implementing a read-aside caching strategy in our application.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/momentohq/public-dev-docs/tree/main/docs/develop/tutorials/serverless-cache-walkthrough/3-configuring-momento.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>このページを編集</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="ドキュメントのナビゲーション"><a class="pagination-nav__link pagination-nav__link--prev" href="/ja/develop/tutorials/serverless-cache-walkthrough/deploying-a-basic-serverless-application"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">基本的なサーバーレスアプリケーションをデプロイ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/ja/develop/tutorials/serverless-cache-walkthrough/read-aside-caching-with-momento"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">Momento でRead-aside キャッシュ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#key-concepts-about-the-lambda-runtime-model" class="table-of-contents__link toc-highlight">Key concepts about the Lambda runtime model</a><ul><li><a href="#lambda-lifecycle-and-cold-starts" class="table-of-contents__link toc-highlight">Lambda lifecycle and cold starts</a></li><li><a href="#service-code-and-object-reuse" class="table-of-contents__link toc-highlight">Service code and object reuse</a></li></ul></li><li><a href="#installing-and-configuring-momento-in-your-serverless-application" class="table-of-contents__link toc-highlight">Installing and configuring Momento in your serverless application</a><ul><li><a href="#signing-up-for-momento-and-getting-an-authentication-token" class="table-of-contents__link toc-highlight">Signing up for Momento and getting an authentication token</a></li><li><a href="#storing-our-authentication-token-in-aws-secrets-manager" class="table-of-contents__link toc-highlight">Storing our authentication token in AWS Secrets Manager</a></li><li><a href="#installing-and-configuring-our-momento-client" class="table-of-contents__link toc-highlight">Installing and configuring our Momento client</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ドキュメント</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ja/">ドキュメント ホーム</a></li></ul></div><div class="col footer__col"><div class="footer__title">コミュニティ</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/3HkAKjUZGq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><div class="footer__title">もっと見る</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.gomomento.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">公式ブログ</a></li><li class="footer__item"><a href="https://github.com/momentohq" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><div class="footer__title">言語</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.momentohq.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">English</a></li><li class="footer__item"><a href="https://docs.momentohq.com/ja/" target="_blank" rel="noopener noreferrer" class="footer__link-item">日本語</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/ja/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/ja/img/footer_logo.svg" alt="Momento Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></div><div class="footer__copyright">Copyright © 2022 Momento, Inc.</div></div></div></footer></div>
<script src="/ja/assets/js/runtime~main.26a36ed7.js"></script>
<script src="/ja/assets/js/main.7bb27a3e.js"></script>
<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-THBDHDQ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) --></body>
</html>